The device\textquotesingle{}s purpose is to make it possible to connect up to the {\ttfamily Can\+Battery} sensor to a single EMS board. This device works with the {\ttfamily bms} board. Note that the board can not be programmed for different message rates.\hypertarget{md_icub_main_src_libraries_icubmod_embObjBattery_README_autotoc_md5}{}\doxysection{1.\+1. Prerequisite}\label{md_icub_main_src_libraries_icubmod_embObjBattery_README_autotoc_md5}
The following modules should be included in the compilation process\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{ENABLE\_icubmod\_embObjCanBattery   ON}

\end{DoxyCode}
\hypertarget{md_icub_main_src_libraries_icubmod_embObjBattery_README_autotoc_md6}{}\doxysection{2. XML configuration file}\label{md_icub_main_src_libraries_icubmod_embObjBattery_README_autotoc_md6}
This device should be used with XMLs like the following\+:

The root XML\+: 
\begin{DoxyCode}{0}
\DoxyCodeLine{<?\textcolor{keyword}{xml} \textcolor{keyword}{version}=\textcolor{stringliteral}{"{}1.0"{}} \textcolor{keyword}{encoding}=\textcolor{stringliteral}{"{}UTF-\/8"{}} ?>}
\DoxyCodeLine{<!\textcolor{keyword}{DOCTYPE} \textcolor{keyword}{robot} \textcolor{keyword}{PUBLIC} \textcolor{stringliteral}{"{}-\///YARP//DTD yarprobotinterface 3.0//EN"{}} \textcolor{stringliteral}{"{}http://www.yarp.it/DTD/yarprobotinterfaceV3.0.dtd"{}}>}
\DoxyCodeLine{}
\DoxyCodeLine{    <\textcolor{keywordtype}{robot} \textcolor{keyword}{name}=\textcolor{stringliteral}{"{}testFT"{}} \textcolor{keyword}{build}=\textcolor{stringliteral}{"{}1"{}} \textcolor{keyword}{portprefix}=\textcolor{stringliteral}{"{}icub"{}} \textcolor{keyword}{xmlns:xi}=\textcolor{stringliteral}{"{}http://www.w3.org/2001/XInclude"{}}>}
\DoxyCodeLine{        <\textcolor{keywordtype}{params}>}
\DoxyCodeLine{    <\textcolor{keywordtype}{xi:include} \textcolor{keyword}{href}=\textcolor{stringliteral}{"{}hardware/electronics/pc104.xml"{}} />}
\DoxyCodeLine{        </\textcolor{keywordtype}{params}>}
\DoxyCodeLine{        }
\DoxyCodeLine{    <\textcolor{keywordtype}{devices}>}
\DoxyCodeLine{ }
\DoxyCodeLine{ }
\DoxyCodeLine{    \textcolor{comment}{<!-\/-\/ ANALOG SENSOR CANBATTERY -\/-\/>}}
\DoxyCodeLine{    <\textcolor{keywordtype}{xi:include} \textcolor{keyword}{href}=\textcolor{stringliteral}{"{}wrappers/CanBattery/testCanBattery\_wrapper.xml"{}} />    }
\DoxyCodeLine{    <\textcolor{keywordtype}{xi:include} \textcolor{keyword}{href}=\textcolor{stringliteral}{"{}hardware/CanBattery/eb1-\/j0-\/strain2-\/canbattery.xml"{}} /> }
\DoxyCodeLine{  }
\DoxyCodeLine{      }
\DoxyCodeLine{    </\textcolor{keywordtype}{devices}>}
\DoxyCodeLine{</\textcolor{keywordtype}{robot}> }

\end{DoxyCode}


The device XML in {\ttfamily hardware\textbackslash{}can\+Battery} (refer to the root XML file)\+: 
\begin{DoxyCode}{0}
\DoxyCodeLine{<?\textcolor{keyword}{xml} \textcolor{keyword}{version}=\textcolor{stringliteral}{"{}1.0"{}} \textcolor{keyword}{encoding}=\textcolor{stringliteral}{"{}UTF-\/8"{}}?>}
\DoxyCodeLine{<!\textcolor{keyword}{DOCTYPE} \textcolor{keyword}{device} \textcolor{keyword}{PUBLIC} \textcolor{stringliteral}{"{}-\///YARP//DTD yarprobotinterface 3.0//EN"{}} \textcolor{stringliteral}{"{}http://www.yarp.it/DTD/yarprobotinterfaceV3.0.dtd"{}}>}
\DoxyCodeLine{}
\DoxyCodeLine{<\textcolor{keywordtype}{device} \textcolor{keyword}{xmlns:xi}=\textcolor{stringliteral}{"{}http://www.w3.org/2001/XInclude"{}} \textcolor{keyword}{name}=\textcolor{stringliteral}{"{}canbattery"{}} \textcolor{keyword}{type}=\textcolor{stringliteral}{"{}embObjBattery"{}}>}
\DoxyCodeLine{}
\DoxyCodeLine{    <\textcolor{keywordtype}{xi:include} \textcolor{keyword}{href}=\textcolor{stringliteral}{"{}../../general.xml"{}} />}
\DoxyCodeLine{}
\DoxyCodeLine{    \textcolor{comment}{<!-\/-\/ This value must match the net board name in the corresponding hardware/electronics/... file -\/-\/>}}
\DoxyCodeLine{    <\textcolor{keywordtype}{xi:include} \textcolor{keyword}{href}=\textcolor{stringliteral}{"{}../electronics/left\_arm-\/eb1-\/j0\_1-\/eln.xml"{}} />}
\DoxyCodeLine{}
\DoxyCodeLine{    <\textcolor{keywordtype}{group} \textcolor{keyword}{name}=\textcolor{stringliteral}{"{}SERVICE"{}}>}
\DoxyCodeLine{}
\DoxyCodeLine{        <\textcolor{keywordtype}{param} \textcolor{keyword}{name}=\textcolor{stringliteral}{"{}type"{}}> \textcolor{keyword}{eomn\_serv\_AS\_battery} </\textcolor{keywordtype}{param}>}
\DoxyCodeLine{}
\DoxyCodeLine{        <\textcolor{keywordtype}{group} \textcolor{keyword}{name}=\textcolor{stringliteral}{"{}PROPERTIES"{}}>}
\DoxyCodeLine{}
\DoxyCodeLine{            <\textcolor{keywordtype}{group} \textcolor{keyword}{name}=\textcolor{stringliteral}{"{}CANBOARDS"{}}>}
\DoxyCodeLine{                <\textcolor{keywordtype}{param} \textcolor{keyword}{name}=\textcolor{stringliteral}{"{}type"{}}>                 \textcolor{keyword}{bms}      </\textcolor{keywordtype}{param}>}
\DoxyCodeLine{}
\DoxyCodeLine{                <\textcolor{keywordtype}{group} \textcolor{keyword}{name}=\textcolor{stringliteral}{"{}PROTOCOL"{}}>}
\DoxyCodeLine{                    <\textcolor{keywordtype}{param} \textcolor{keyword}{name}=\textcolor{stringliteral}{"{}major"{}}>            0                   </\textcolor{keywordtype}{param}>}
\DoxyCodeLine{                    <\textcolor{keywordtype}{param} \textcolor{keyword}{name}=\textcolor{stringliteral}{"{}minor"{}}>            0                      </\textcolor{keywordtype}{param}>}
\DoxyCodeLine{                </\textcolor{keywordtype}{group}>}
\DoxyCodeLine{                <\textcolor{keywordtype}{group} \textcolor{keyword}{name}=\textcolor{stringliteral}{"{}FIRMWARE"{}}>}
\DoxyCodeLine{                    <\textcolor{keywordtype}{param} \textcolor{keyword}{name}=\textcolor{stringliteral}{"{}major"{}}>            0                   </\textcolor{keywordtype}{param}>}
\DoxyCodeLine{                    <\textcolor{keywordtype}{param} \textcolor{keyword}{name}=\textcolor{stringliteral}{"{}minor"{}}>            0                   </\textcolor{keywordtype}{param}>}
\DoxyCodeLine{                    <\textcolor{keywordtype}{param} \textcolor{keyword}{name}=\textcolor{stringliteral}{"{}build"{}}>            0                   </\textcolor{keywordtype}{param}>}
\DoxyCodeLine{                </\textcolor{keywordtype}{group}>}
\DoxyCodeLine{            </\textcolor{keywordtype}{group}>}
\DoxyCodeLine{}
\DoxyCodeLine{            <\textcolor{keywordtype}{group} \textcolor{keyword}{name}=\textcolor{stringliteral}{"{}SENSORS"{}}>}
\DoxyCodeLine{                <\textcolor{keywordtype}{param} \textcolor{keyword}{name}=\textcolor{stringliteral}{"{}id"{}}>                   \textcolor{keyword}{battery1}        </\textcolor{keywordtype}{param}>}
\DoxyCodeLine{                <\textcolor{keywordtype}{param} \textcolor{keyword}{name}=\textcolor{stringliteral}{"{}board"{}}>                \textcolor{keyword}{bms}             </\textcolor{keywordtype}{param}>}
\DoxyCodeLine{                <\textcolor{keywordtype}{param} \textcolor{keyword}{name}=\textcolor{stringliteral}{"{}location"{}}>             \textcolor{keyword}{CAN2:13}         </\textcolor{keywordtype}{param}>}
\DoxyCodeLine{            </\textcolor{keywordtype}{group}>}
\DoxyCodeLine{}
\DoxyCodeLine{        </\textcolor{keywordtype}{group}>}
\DoxyCodeLine{}
\DoxyCodeLine{}
\DoxyCodeLine{        <\textcolor{keywordtype}{group} \textcolor{keyword}{name}=\textcolor{stringliteral}{"{}SETTINGS"{}}>}
\DoxyCodeLine{            <\textcolor{keywordtype}{param} \textcolor{keyword}{name}=\textcolor{stringliteral}{"{}enabledSensors"{}}>            \textcolor{keyword}{battery1}        </\textcolor{keywordtype}{param}>}
\DoxyCodeLine{            <\textcolor{keywordtype}{param} \textcolor{keyword}{name}=\textcolor{stringliteral}{"{}acquisitionRate"{}}>           1000            </\textcolor{keywordtype}{param}>   \textcolor{comment}{<!-\/-\/ msec -\/-\/>}}
\DoxyCodeLine{        </\textcolor{keywordtype}{group}>}
\DoxyCodeLine{}
\DoxyCodeLine{}
\DoxyCodeLine{    </\textcolor{keywordtype}{group}>}
\DoxyCodeLine{}
\DoxyCodeLine{</\textcolor{keywordtype}{device}>}

\end{DoxyCode}


And the XML wrapper in {\ttfamily .\textbackslash{}wrappers\textbackslash{}can\+Battery} (refer to the root XML file)\+::


\begin{DoxyCode}{0}
\DoxyCodeLine{<?\textcolor{keyword}{xml} \textcolor{keyword}{version}=\textcolor{stringliteral}{"{}1.0"{}} \textcolor{keyword}{encoding}=\textcolor{stringliteral}{"{}UTF-\/8"{}} ?>}
\DoxyCodeLine{<!\textcolor{keyword}{DOCTYPE} \textcolor{keyword}{devices} \textcolor{keyword}{PUBLIC} \textcolor{stringliteral}{"{}-\///YARP//DTD yarprobotinterface 3.0//EN"{}} \textcolor{stringliteral}{"{}http://www.yarp.it/DTD/yarprobotinterfaceV3.0.dtd"{}}>}
\DoxyCodeLine{<\textcolor{keywordtype}{device} \textcolor{keyword}{xmlns:xi}=\textcolor{stringliteral}{"{}http://www.w3.org/2001/XInclude"{}} \textcolor{keyword}{name}=\textcolor{stringliteral}{"{}battery\_wrapper"{}} \textcolor{keyword}{type}=\textcolor{stringliteral}{"{}batteryWrapper"{}}>}
\DoxyCodeLine{    <\textcolor{keywordtype}{param} \textcolor{keyword}{name}=\textcolor{stringliteral}{"{}period"{}}>       1                  </\textcolor{keywordtype}{param}> }
\DoxyCodeLine{    <\textcolor{keywordtype}{param} \textcolor{keyword}{name}=\textcolor{stringliteral}{"{}name"{}}>       /\textcolor{keyword}{icub}/\textcolor{keyword}{battery}      </\textcolor{keywordtype}{param}>}
\DoxyCodeLine{}
\DoxyCodeLine{    <\textcolor{keywordtype}{action} \textcolor{keyword}{phase}=\textcolor{stringliteral}{"{}startup"{}} \textcolor{keyword}{level}=\textcolor{stringliteral}{"{}5"{}} \textcolor{keyword}{type}=\textcolor{stringliteral}{"{}attach"{}}>}
\DoxyCodeLine{        <\textcolor{keywordtype}{paramlist} \textcolor{keyword}{name}=\textcolor{stringliteral}{"{}networks"{}}>}
\DoxyCodeLine{        \textcolor{comment}{<!-\/-\/ This value must match the device name in the corresponding hardware/battery/canBattery.xml file -\/-\/>}}
\DoxyCodeLine{            <\textcolor{keywordtype}{elem} \textcolor{keyword}{name}=\textcolor{stringliteral}{"{}battery"{}}>  \textcolor{keyword}{canbattery} </\textcolor{keywordtype}{elem}>}
\DoxyCodeLine{        </\textcolor{keywordtype}{paramlist}>}
\DoxyCodeLine{    </\textcolor{keywordtype}{action}>}
\DoxyCodeLine{}
\DoxyCodeLine{    <\textcolor{keywordtype}{action} \textcolor{keyword}{phase}=\textcolor{stringliteral}{"{}shutdown"{}} \textcolor{keyword}{level}=\textcolor{stringliteral}{"{}5"{}} \textcolor{keyword}{type}=\textcolor{stringliteral}{"{}detach"{}} />}
\DoxyCodeLine{</\textcolor{keywordtype}{device}>}

\end{DoxyCode}
\hypertarget{md_icub_main_src_libraries_icubmod_embObjBattery_README_autotoc_md7}{}\doxysection{3. Yarp output}\label{md_icub_main_src_libraries_icubmod_embObjBattery_README_autotoc_md7}
\hypertarget{md_icub_main_src_libraries_icubmod_embObjBattery_README_autotoc_md8}{}\doxysubsection{3.\+1. Ports}\label{md_icub_main_src_libraries_icubmod_embObjBattery_README_autotoc_md8}
As for the wrapper file\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{/<robot\_name>/battery/data:o }
\DoxyCodeLine{/<robot\_name>/battery/rpc:o}

\end{DoxyCode}
\hypertarget{md_icub_main_src_libraries_icubmod_embObjBattery_README_autotoc_md9}{}\doxysubsection{3.\+2. Output format}\label{md_icub_main_src_libraries_icubmod_embObjBattery_README_autotoc_md9}
The output from bash commend 
\begin{DoxyCode}{0}
\DoxyCodeLine{yarp read ... /icub/battery/data:o}

\end{DoxyCode}


{\ttfamily 40 3.\+300000011920928955078 80.\+0 31.\+0 0} ~\newline
 {\ttfamily voltage -\/-\/ current -\/-\/ charge -\/-\/ temperature -\/-\/ status}

Voltage in Volt Current in Amper Charge in percent Temperature in degree Celtius Status not used for now\hypertarget{md_icub_main_src_libraries_icubmod_embObjBattery_README_autotoc_md10}{}\doxysection{4. Battery client}\label{md_icub_main_src_libraries_icubmod_embObjBattery_README_autotoc_md10}
To receive data from the device you should use the i\+Battery interface. See a complete example here\+: \href{https://github.com/robotology/yarp/tree/master/src/yarpbatterygui}{\texttt{ https\+://github.\+com/robotology/yarp/tree/master/src/yarpbatterygui}}\hypertarget{md_icub_main_src_libraries_icubmod_embObjBattery_README_autotoc_md11}{}\doxysection{5. Debug}\label{md_icub_main_src_libraries_icubmod_embObjBattery_README_autotoc_md11}
\hypertarget{md_icub_main_src_libraries_icubmod_embObjBattery_README_autotoc_md12}{}\doxysubsection{5.\+1. Install folder}\label{md_icub_main_src_libraries_icubmod_embObjBattery_README_autotoc_md12}
If you have already installed robotology-\/superbuild and you have cloned icub-\/main (and you are working here) overwrite robotology-\/superbuild binary like this in your icub-\/main\+: 
\begin{DoxyCode}{0}
\DoxyCodeLine{CMAKE\_INSTALL\_PREFIX             <path\_to\_robotology>/robotology-\/superbuild/build/install}

\end{DoxyCode}
\hypertarget{md_icub_main_src_libraries_icubmod_embObjBattery_README_autotoc_md13}{}\doxysubsection{5.\+2. Visual studio code debugging}\label{md_icub_main_src_libraries_icubmod_embObjBattery_README_autotoc_md13}
Use the following launch.\+json 
\begin{DoxyCode}{0}
\DoxyCodeLine{    \{}
\DoxyCodeLine{    "{}version"{}: "{}0.2.0"{},}
\DoxyCodeLine{    "{}configurations"{}: [}
\DoxyCodeLine{    \{}
\DoxyCodeLine{            "{}name"{}: "{}App debug battery sensor"{},}
\DoxyCodeLine{            "{}type"{}: "{}cppdbg"{},}
\DoxyCodeLine{            "{}request"{}: "{}launch"{},}
\DoxyCodeLine{            "{}program"{}: "{}<robotology-\/path>/robotology-\/superbuild/build/install/bin/yarprobotinterface"{},}
\DoxyCodeLine{            "{}args"{}: [],}
\DoxyCodeLine{            "{}stopAtEntry"{}: false,}
\DoxyCodeLine{            "{}cwd"{}: "{}<xmlconfig-\/files>/yarprobotinterface-\/config-\/canbattery"{},}
\DoxyCodeLine{            "{}environment"{}: [],}
\DoxyCodeLine{            "{}externalConsole"{}: false,}
\DoxyCodeLine{            "{}MIMode"{}: "{}gdb"{},}
\DoxyCodeLine{            "{}setupCommands"{}: [}
\DoxyCodeLine{                \{}
\DoxyCodeLine{                    "{}description"{}: "{}Enable pretty-\/printing for gdb"{},}
\DoxyCodeLine{                    "{}text"{}: "{}-\/enable-\/pretty-\/printing"{},}
\DoxyCodeLine{                    "{}ignoreFailures"{}: true}
\DoxyCodeLine{                \},}
\DoxyCodeLine{                \{}
\DoxyCodeLine{                    "{}description"{}: "{}Set Disassembly Flavor to Intel"{},}
\DoxyCodeLine{                    "{}text"{}: "{}-\/gdb-\/set disassembly-\/flavor intel"{},}
\DoxyCodeLine{                    "{}ignoreFailures"{}: true}
\DoxyCodeLine{                \}}
\DoxyCodeLine{            ],}
\DoxyCodeLine{            "{}miDebuggerPath"{}: "{}/usr/bin/gdb"{},}
\DoxyCodeLine{        \},}
\DoxyCodeLine{        \{}
\DoxyCodeLine{        "{}name"{}: "{}UT debug battery sensor"{},}
\DoxyCodeLine{        "{}type"{}: "{}cppdbg"{},}
\DoxyCodeLine{        "{}request"{}: "{}launch"{},}
\DoxyCodeLine{        "{}program"{}: "{}/home/triccyx/Documents/robotology-\/superbuild/build/install/bin/unittest"{},}
\DoxyCodeLine{        "{}args"{}: [],}
\DoxyCodeLine{        "{}stopAtEntry"{}: false,}
\DoxyCodeLine{        "{}cwd"{}: "{}/home/triccyx/Documents/robotology-\/superbuild/build/install/bin"{},}
\DoxyCodeLine{        "{}environment"{}: [],}
\DoxyCodeLine{        "{}externalConsole"{}: false,}
\DoxyCodeLine{        "{}MIMode"{}: "{}gdb"{},}
\DoxyCodeLine{        "{}setupCommands"{}: [}
\DoxyCodeLine{            \{}
\DoxyCodeLine{                "{}description"{}: "{}Enable pretty-\/printing for gdb"{},}
\DoxyCodeLine{                "{}text"{}: "{}-\/enable-\/pretty-\/printing"{},}
\DoxyCodeLine{                "{}ignoreFailures"{}: true}
\DoxyCodeLine{            \},}
\DoxyCodeLine{            \{}
\DoxyCodeLine{                "{}description"{}: "{}Set Disassembly Flavor to Intel"{},}
\DoxyCodeLine{                "{}text"{}: "{}-\/gdb-\/set disassembly-\/flavor intel"{},}
\DoxyCodeLine{                "{}ignoreFailures"{}: true}
\DoxyCodeLine{            \}}
\DoxyCodeLine{        ],}
\DoxyCodeLine{        "{}miDebuggerPath"{}: "{}/usr/bin/gdb"{},}
\DoxyCodeLine{    \}}
\DoxyCodeLine{    ]}
\DoxyCodeLine{\}}

\end{DoxyCode}
 Also select as build type DEBUG\hypertarget{md_icub_main_src_libraries_icubmod_embObjBattery_README_autotoc_md14}{}\doxysection{6. Unittest}\label{md_icub_main_src_libraries_icubmod_embObjBattery_README_autotoc_md14}
The device has a set of unittest that can be activated with\+: 
\begin{DoxyCode}{0}
\DoxyCodeLine{BUILD\_TESTING                    ON}

\end{DoxyCode}
 