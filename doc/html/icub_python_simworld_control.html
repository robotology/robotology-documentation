<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>iCub-main: Controlling the iCub Simulator from Python</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">iCub-main
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Controlling the <a class="el" href="namespaceiCub.html" title="This file contains the definition of unique IDs for the body parts and the skin parts of the robot.">iCub</a> Simulator from Python </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><dl class="section author"><dt>Author</dt><dd>Marek Rucinski</dd></dl>
<h1><a class="anchor" id="sec_goal"></a>
Goal</h1>
<p>This tutorial shows how to control the <a class="el" href="namespaceiCub.html" title="This file contains the definition of unique IDs for the body parts and the skin parts of the robot.">iCub</a> simulator via YARP bindings for Python. Since there is no dedicated <a class="el" href="namespaceiCub.html" title="This file contains the definition of unique IDs for the body parts and the skin parts of the robot.">iCub</a> simulator API available, this has to be achieved via the YARP RPC mechanism. Therefore, this tutorial should also give you a general idea on how to use the RPC interfaces from Python.</p>
<p>It is assumed that you have already compiled or installed the Python bindings. This tutorial assumes basic knowledge of how YARP works in C++, familiarity with YARP RPC mechanism, the specific RPC interface of the <a class="el" href="namespaceiCub.html" title="This file contains the definition of unique IDs for the body parts and the skin parts of the robot.">iCub</a> simulator (described in the simulator README) as well as some basic knowledge of Python, it's essential packages and functions.</p>
<p>This tutorial has the form of a small Python module which implements a WorldController class used to communicate with the <a class="el" href="namespaceiCub.html" title="This file contains the definition of unique IDs for the body parts and the skin parts of the robot.">iCub</a> simulator. Full code of this module can be found in <a class="el" href="python__simworld__control_8py.html">python/python_simworld_control.py</a></p>
<h1><a class="anchor" id="sec_start"></a>
Module initialisation</h1>
<p>As usual, we have to import all modules we'll need, most prominently the yarp python bindings.</p>
<div class="fragment"><div class="line"><span class="keyword">import</span> collections</div>
<div class="line"><span class="keyword">import</span> <a class="code" href="namespaceyarp.html">yarp</a></div>
<div class="line"> </div>
<div class="line"><a class="code" href="namespaceyarp.html">yarp</a>.Network.init() # Initialise YARP</div>
<div class="ttc" id="anamespaceyarp_html"><div class="ttname"><a href="namespaceyarp.html">yarp</a></div><div class="ttdoc">Copyright (C) 2008 RobotCub Consortium.</div><div class="ttdef"><b>Definition:</b> <a href="DebugInterfaces_8h_source.html#l00051">DebugInterfaces.h:51</a></div></div>
</div><!-- fragment --><p>Placing the call to yarp.Network.init() directly in the module code (as opposed to putting it inside some function defined later in the module) ensures that YARP is initialised as soon as the module is imported.</p>
<h1><a class="anchor" id="sec_wctl"></a>
WorldController class</h1>
<p>Now we're ready to define our WorldController class. At initialisation we create an RpcClient object used for communitation and connect it to the world port of the simulator (therefore the simulator must be up and running when an object of the WorldController class is created!):</p>
<div class="fragment"><div class="line"><span class="keyword">class </span>WorldController:</div>
<div class="line">    &quot;&quot;&quot;Class for controlling <a class="code" href="namespaceiCub.html">iCub</a> simulator via its RPC world port.&quot;&quot;&quot;</div>
<div class="line"> </div>
<div class="line">    def __init__(self):</div>
<div class="line">        <a class="code" href="firmwareupdatercore_8cpp.html#a396f1276c4c0cd4c8ea515f853c8494f">self</a>._rpc_client = <a class="code" href="namespaceyarp.html">yarp</a>.RpcClient()</div>
<div class="line">        <a class="code" href="firmwareupdatercore_8cpp.html#a396f1276c4c0cd4c8ea515f853c8494f">self</a>._port_name = &quot;/WorldController-&quot; + str(id(self)) + &quot;/<a class="code" href="diagnostics__buttons_8cpp.html#aaad2f6556489c51f2c24302e2cb4188a">commands</a>&quot;</div>
<div class="line">        <a class="code" href="firmwareupdatercore_8cpp.html#a396f1276c4c0cd4c8ea515f853c8494f">self</a>._rpc_client.open(self._port_name)</div>
<div class="line">        <a class="code" href="firmwareupdatercore_8cpp.html#a396f1276c4c0cd4c8ea515f853c8494f">self</a>._rpc_client.addOutput(&quot;/icubSim/world&quot;)</div>
<div class="line">        </div>
<div class="line"><span class="preprocessor">        # A dictionary to track simulator object IDs for all types of objects</span></div>
<div class="line">        <a class="code" href="firmwareupdatercore_8cpp.html#a396f1276c4c0cd4c8ea515f853c8494f">self</a>._sim_ids_counters = collections.defaultdict(lambda:0)</div>
<div class="line">        </div>
<div class="line"><span class="preprocessor">        # A sequence to track internal object IDs. This list stores tuples (object type, simulator id)</span></div>
<div class="line"><span class="preprocessor">        # so that outside one does not have to remember the type of object.</span></div>
<div class="line"><span class="preprocessor">        self._objects = [ ]</span></div>
<div class="ttc" id="adiagnostics__buttons_8cpp_html_aaad2f6556489c51f2c24302e2cb4188a"><div class="ttname"><a href="diagnostics__buttons_8cpp.html#aaad2f6556489c51f2c24302e2cb4188a">commands</a></div><div class="ttdeci">void commands(void)</div><div class="ttdef"><b>Definition:</b> <a href="diagnostics__buttons_8cpp_source.html#l00085">diagnostics_buttons.cpp:85</a></div></div>
<div class="ttc" id="afirmwareupdatercore_8cpp_html_a396f1276c4c0cd4c8ea515f853c8494f"><div class="ttname"><a href="firmwareupdatercore_8cpp.html#a396f1276c4c0cd4c8ea515f853c8494f">self</a></div><div class="ttdeci">FirmwareUpdaterCore * self</div><div class="ttdef"><b>Definition:</b> <a href="firmwareupdatercore_8cpp_source.html#l00005">firmwareupdatercore.cpp:5</a></div></div>
<div class="ttc" id="anamespaceiCub_html"><div class="ttname"><a href="namespaceiCub.html">iCub</a></div><div class="ttdoc">This file contains the definition of unique IDs for the body parts and the skin parts of the robot.</div><div class="ttdef"><b>Definition:</b> <a href="emotionInterface_8h_source.html#l00017">emotionInterface.h:17</a></div></div>
</div><!-- fragment --><p>Including id(self) in the local port name allows us to use multiple instances of the WorldController class at the same time without having yarp port name conflicts.</p>
<p>At the end of the constructor we prepare two data structures which will help us manage simulator object identifiers. Object identifiers in the <a class="el" href="namespaceiCub.html" title="This file contains the definition of unique IDs for the body parts and the skin parts of the robot.">iCub</a> simulator are not unique, in other words you can have two objects (of different types, e.g. a 'sph' and a 'box'), having the same identifier (e.g. 1). This is rather inconvenient because one has to keep track of object types together with their identifiers. We'll use the WorldController class to maintain a single pool of identifiers, so that we can later refer to an object via its identifier only. self._sim_ids_counters is a dictionary indexed by object type ('sph', 'box', etc.) counting the number objects of each type created so far. self._objects is a sequence of pairs (object type, simulator object id) which will translate our unique object identifiers (essentially indexes of objects on this list) to simulator identifiers.</p>
<p>Now we'll define two helper methods useful for RPC communication:</p>
<div class="fragment"><div class="line">def _execute(<span class="keyword">self</span>, <a class="code" href="dataTypes_8h.html#a4d43e8212bdc9dbee866506f04effcea">cmd</a>):</div>
<div class="line">    <span class="stringliteral">&quot;&quot;</span><span class="stringliteral">&quot;Execute an RPC command, returning obtained answer bottle.&quot;</span><span class="stringliteral">&quot;&quot;</span></div>
<div class="line">    ans = <a class="code" href="namespaceyarp.html">yarp</a>.Bottle()     </div>
<div class="line">    <a class="code" href="firmwareupdatercore_8cpp.html#a396f1276c4c0cd4c8ea515f853c8494f">self</a>._rpc_client.<a class="code" href="namespacestrain_1_1regulation.html#a66bdbf1c2aeb26b5d2fa61419b2576a2">write</a>(<a class="code" href="dataTypes_8h.html#a4d43e8212bdc9dbee866506f04effcea">cmd</a>, ans)</div>
<div class="line">    return ans</div>
<div class="line"> </div>
<div class="line">def _is_success(<a class="code" href="firmwareupdatercore_8cpp.html#a396f1276c4c0cd4c8ea515f853c8494f">self</a>, ans):</div>
<div class="line">    <span class="stringliteral">&quot;&quot;</span><span class="stringliteral">&quot;Check if RPC call answer Bottle indicates successfull execution.&quot;</span><span class="stringliteral">&quot;&quot;</span></div>
<div class="line">    return ans.size() == 1 and ans.get(0).asVocab() == 27503 # Vocab for <span class="stringliteral">&#39;[ok]&#39;</span></div>
<div class="ttc" id="adataTypes_8h_html_a4d43e8212bdc9dbee866506f04effcea"><div class="ttname"><a href="dataTypes_8h.html#a4d43e8212bdc9dbee866506f04effcea">cmd</a></div><div class="ttdeci">cmd</div><div class="ttdef"><b>Definition:</b> <a href="dataTypes_8h_source.html#l00030">dataTypes.h:30</a></div></div>
<div class="ttc" id="anamespacestrain_1_1regulation_html_a66bdbf1c2aeb26b5d2fa61419b2576a2"><div class="ttname"><a href="namespacestrain_1_1regulation.html#a66bdbf1c2aeb26b5d2fa61419b2576a2">strain::regulation::write</a></div><div class="ttdeci">bool write(const std::string filename, const FullRegulation &amp;reg)</div></div>
</div><!-- fragment --><p>Underscore in front of a class member name is Python convention for indicating "protected" class members, i.e. those not intended to be used directly by the user.</p>
<p>The most annoying part of executing an RPC call is preparation of the command bottle. In our code we'll separate the command preparation code from the code which actually executes the command and checks if the call was successful.</p>
<p>As a starting point, let's take the "world del all" command which removes all objects created in the simulator. This is a simple command which takes no arguments, therefore the code is also quite simple:</p>
<div class="fragment"><div class="line">def _prepare_del_all_command(<span class="keyword">self</span>):</div>
<div class="line">    <span class="stringliteral">&quot;&quot;</span><span class="stringliteral">&quot;Prepare the &quot;</span>world del all<span class="stringliteral">&quot; command bottle.&quot;</span><span class="stringliteral">&quot;&quot;</span></div>
<div class="line">    result = <a class="code" href="namespaceyarp.html">yarp</a>.Bottle()</div>
<div class="line">    result.clear()</div>
<div class="line">    <a class="code" href="namespaceiCub_1_1learningmachine_1_1math.html#a71fd1dc7676d2de7d7ed6617b15e9a5f">map</a>(result.addString, [ <span class="stringliteral">&quot;world&quot;</span>, <span class="stringliteral">&quot;del&quot;</span>, <span class="stringliteral">&quot;all&quot;</span> ])</div>
<div class="line">    return result</div>
<div class="line">    </div>
<div class="line">def del_all(<a class="code" href="firmwareupdatercore_8cpp.html#a396f1276c4c0cd4c8ea515f853c8494f">self</a>):</div>
<div class="line">    <span class="stringliteral">&quot;&quot;</span><span class="stringliteral">&quot;Delete all objects from the simultor&quot;</span><span class="stringliteral">&quot;&quot;</span></div>
<div class="line">    result = <a class="code" href="firmwareupdatercore_8cpp.html#a396f1276c4c0cd4c8ea515f853c8494f">self</a>._is_success(<a class="code" href="firmwareupdatercore_8cpp.html#a396f1276c4c0cd4c8ea515f853c8494f">self</a>._execute(<a class="code" href="firmwareupdatercore_8cpp.html#a396f1276c4c0cd4c8ea515f853c8494f">self</a>._prepare_del_all_command()))</div>
<div class="line">    </div>
<div class="line">    if result:</div>
<div class="line">        # Clear the counters</div>
<div class="line">        <a class="code" href="firmwareupdatercore_8cpp.html#a396f1276c4c0cd4c8ea515f853c8494f">self</a>._sim_ids_counters.clear()</div>
<div class="line">        del <a class="code" href="firmwareupdatercore_8cpp.html#a396f1276c4c0cd4c8ea515f853c8494f">self</a>._objects[:]</div>
<div class="line">    </div>
<div class="line">    return result</div>
<div class="ttc" id="anamespaceiCub_1_1learningmachine_1_1math_html_a71fd1dc7676d2de7d7ed6617b15e9a5f"><div class="ttname"><a href="namespaceiCub_1_1learningmachine_1_1math.html#a71fd1dc7676d2de7d7ed6617b15e9a5f">iCub::learningmachine::math::map</a></div><div class="ttdeci">yarp::sig::Vector &amp; map(yarp::sig::Vector &amp;v, double(op)(double))</div><div class="ttdoc">Performs a unary operator inplace on each element of a vector.</div><div class="ttdef"><b>Definition:</b> <a href="Math_8cpp_source.html#l00305">Math.cpp:305</a></div></div>
</div><!-- fragment --><p>Note that upon successful deletion of objects from the simulator, we update internal structures for tracking identifiers.</p>
<p>Now for something a little more interesting. RPC interface of the simulator allows creating various objects (spheres, cylinders, etc.) in the simulated world. Let's define a function to prepare the "world mk" command Bottle:</p>
<div class="fragment"><div class="line">def _prepare_create_command(<span class="keyword">self</span>, obj, size, location, colour):</div>
<div class="line">    <span class="stringliteral">&quot;&quot;</span><span class="stringliteral">&quot;Prepare an RPC command for creating an object in the simulator environment.</span></div>
<div class="line"><span class="stringliteral">    </span></div>
<div class="line"><span class="stringliteral">    See Simulator Readme section &#39;Object Creation&#39;</span></div>
<div class="line"><span class="stringliteral">    </span></div>
<div class="line"><span class="stringliteral">    Parameters:</span></div>
<div class="line"><span class="stringliteral">        obj - object type string. &#39;sph&#39;, &#39;box&#39;, &#39;cyl&#39; &#39;ssph&#39;, &#39;sbox&#39; or &#39;scyl&#39;.</span></div>
<div class="line"><span class="stringliteral">        size - list of values specifying the size of an object. Parameters depend on object type:</span></div>
<div class="line"><span class="stringliteral">            (s)box: [ x, y, z ]</span></div>
<div class="line"><span class="stringliteral">            (s)sph: [ radius ]</span></div>
<div class="line"><span class="stringliteral">            (s)cyl: [ radius, length ]</span></div>
<div class="line"><span class="stringliteral">        location - coordinates of the object location, [ x, y, z ]</span></div>
<div class="line"><span class="stringliteral">        colour - object colour in RGB (normalised), [ r, g, b ]</span></div>
<div class="line"><span class="stringliteral">    Returns:</span></div>
<div class="line"><span class="stringliteral">        yarp.Bottle with the command, ready to be sent to the rpc port of the simulator</span></div>
<div class="line"><span class="stringliteral">    </span></div>
<div class="line"><span class="stringliteral">    &quot;</span><span class="stringliteral">&quot;&quot;</span></div>
<div class="line">    </div>
<div class="line">    result = <a class="code" href="namespaceyarp.html">yarp</a>.Bottle()</div>
<div class="line">    result.clear()</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="namespaceiCub_1_1learningmachine_1_1math.html#a71fd1dc7676d2de7d7ed6617b15e9a5f">map</a>(result.addString, [<span class="stringliteral">&quot;world&quot;</span>, <span class="stringliteral">&quot;mk&quot;</span>, obj])</div>
<div class="line">    <a class="code" href="namespaceiCub_1_1learningmachine_1_1math.html#a71fd1dc7676d2de7d7ed6617b15e9a5f">map</a>(result.addDouble, size)</div>
<div class="line">    <a class="code" href="namespaceiCub_1_1learningmachine_1_1math.html#a71fd1dc7676d2de7d7ed6617b15e9a5f">map</a>(result.addDouble, location)</div>
<div class="line">    <a class="code" href="namespaceiCub_1_1learningmachine_1_1math.html#a71fd1dc7676d2de7d7ed6617b15e9a5f">map</a>(result.addDouble, colour)</div>
<div class="line">    </div>
<div class="line">    return result</div>
</div><!-- fragment --><p>Note that all dirty work, especially handling different numbers of object size parameters for different types of objects is done for us automatically thanks to the excellent support for sequences in Python. Actually, since size, location and colour are all stored in the Bottle as Doubles, we could have gotten away with only two <a class="el" href="namespaceiCub_1_1learningmachine_1_1math.html#a71fd1dc7676d2de7d7ed6617b15e9a5f" title="Performs a unary operator inplace on each element of a vector.">map()</a> calls, though this would reduce code readability a little bit.</p>
<p>Now the actual method to create objects:</p>
<div class="fragment"><div class="line">def create_object(<span class="keyword">self</span>, obj, size, location, colour):</div>
<div class="line">    <span class="stringliteral">&quot;&quot;</span><span class="stringliteral">&quot;Create an object of a specified type, size, location and colour, returning internal object ID or -1 on error.&quot;</span><span class="stringliteral">&quot;&quot;</span></div>
<div class="line">    </div>
<div class="line">    <a class="code" href="dataTypes_8h.html#a4d43e8212bdc9dbee866506f04effcea">cmd</a> = <a class="code" href="firmwareupdatercore_8cpp.html#a396f1276c4c0cd4c8ea515f853c8494f">self</a>._prepare_create_command(obj, size, location, colour)</div>
<div class="line">    </div>
<div class="line">    if <a class="code" href="firmwareupdatercore_8cpp.html#a396f1276c4c0cd4c8ea515f853c8494f">self</a>._is_success(<a class="code" href="firmwareupdatercore_8cpp.html#a396f1276c4c0cd4c8ea515f853c8494f">self</a>._execute(<a class="code" href="dataTypes_8h.html#a4d43e8212bdc9dbee866506f04effcea">cmd</a>)):</div>
<div class="line">        obj_sim_id = <a class="code" href="firmwareupdatercore_8cpp.html#a396f1276c4c0cd4c8ea515f853c8494f">self</a>._sim_ids_counters[obj] + 1 # <a class="code" href="namespaceiCub.html">iCub</a> simulator IDs start from 1</div>
<div class="line">        </div>
<div class="line">        # Update the counters</div>
<div class="line">        <a class="code" href="firmwareupdatercore_8cpp.html#a396f1276c4c0cd4c8ea515f853c8494f">self</a>._sim_ids_counters[obj] += 1</div>
<div class="line">        <a class="code" href="firmwareupdatercore_8cpp.html#a396f1276c4c0cd4c8ea515f853c8494f">self</a>._objects.<a class="code" href="namespaceiCub_1_1ctrl_1_1dbscan.html#a8f46d9d0251b88939959e0eaeef08608">append</a>((obj, obj_sim_id))</div>
<div class="line">        </div>
<div class="line">        # Internal object IDs are shared among all types of objects and start from 0;</div>
<div class="line"><span class="preprocessor">        # they are essentially indices of the self._objects sequence</span></div>
<div class="line">        <span class="keywordflow">return</span> len(<span class="keyword">self</span>._objects) - 1</div>
<div class="line">    <span class="keywordflow">else</span>:</div>
<div class="line">        <span class="keywordflow">return</span> -1 # <a class="code" href="namespaceiCub_1_1action_1_1log.html#a4ba5ea132464d0ea49d618130163c769a41b05ff8216aae3cac29fe50f6db76c0">error</a></div>
<div class="ttc" id="anamespaceiCub_1_1action_1_1log_html_a4ba5ea132464d0ea49d618130163c769a41b05ff8216aae3cac29fe50f6db76c0"><div class="ttname"><a href="namespaceiCub_1_1action_1_1log.html#a4ba5ea132464d0ea49d618130163c769a41b05ff8216aae3cac29fe50f6db76c0">iCub::action::log::error</a></div><div class="ttdeci">@ error</div><div class="ttdef"><b>Definition:</b> <a href="actionPrimitives_8cpp_source.html#l00066">actionPrimitives.cpp:66</a></div></div>
<div class="ttc" id="anamespaceiCub_1_1ctrl_1_1dbscan_html_a8f46d9d0251b88939959e0eaeef08608"><div class="ttname"><a href="namespaceiCub_1_1ctrl_1_1dbscan.html#a8f46d9d0251b88939959e0eaeef08608">iCub::ctrl::dbscan::append</a></div><div class="ttdeci">void append(const size_t index, shared_ptr&lt; Epsilon_neighbours_t &gt; en)</div><div class="ttdef"><b>Definition:</b> <a href="clustering_8cpp_source.html#l00065">clustering.cpp:65</a></div></div>
</div><!-- fragment --><p>In a similiar way, we can define methods to move objects around the simulator...</p>
<div class="fragment"><div class="line">def _prepare_move_command(<span class="keyword">self</span>, obj, obj_id, location):</div>
<div class="line">    <span class="stringliteral">&quot;&quot;</span><span class="stringliteral">&quot;Prepare the &quot;</span>world set &lt;obj&gt; &lt;xyz&gt;<span class="stringliteral">&quot; command bottle.&quot;</span><span class="stringliteral">&quot;&quot;</span></div>
<div class="line">    result = <a class="code" href="namespaceyarp.html">yarp</a>.Bottle()</div>
<div class="line">    result.clear()</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="namespaceiCub_1_1learningmachine_1_1math.html#a71fd1dc7676d2de7d7ed6617b15e9a5f">map</a>(result.addString, [<span class="stringliteral">&quot;world&quot;</span>, <span class="stringliteral">&quot;set&quot;</span>, obj])</div>
<div class="line">    result.addInt(obj_id)</div>
<div class="line">    <a class="code" href="namespaceiCub_1_1learningmachine_1_1math.html#a71fd1dc7676d2de7d7ed6617b15e9a5f">map</a>(result.addDouble, location)</div>
<div class="line">    </div>
<div class="line">    return result</div>
<div class="line"> </div>
<div class="line">def move_object(<a class="code" href="firmwareupdatercore_8cpp.html#a396f1276c4c0cd4c8ea515f853c8494f">self</a>, obj_id, location):</div>
<div class="line">    <span class="stringliteral">&quot;&quot;</span><span class="stringliteral">&quot;Move an object specified by the internal id to another location.&quot;</span><span class="stringliteral">&quot;&quot;</span></div>
<div class="line">    obj_desc = <a class="code" href="firmwareupdatercore_8cpp.html#a396f1276c4c0cd4c8ea515f853c8494f">self</a>._objects[obj_id]</div>
<div class="line">    return <a class="code" href="firmwareupdatercore_8cpp.html#a396f1276c4c0cd4c8ea515f853c8494f">self</a>._is_success(<a class="code" href="firmwareupdatercore_8cpp.html#a396f1276c4c0cd4c8ea515f853c8494f">self</a>._execute(<a class="code" href="firmwareupdatercore_8cpp.html#a396f1276c4c0cd4c8ea515f853c8494f">self</a>._prepare_move_command(obj_desc[0], obj_desc[1], location)))</div>
</div><!-- fragment --><p>... as well as rotate them, set their colours, querying their positions, etc. Let's take the latter as the final example, as it will illustrate how to handle the result Bottle returned by the RPC call:</p>
<div class="fragment"><div class="line">def _prepare_get_command(<span class="keyword">self</span>, obj, obj_id):</div>
<div class="line">    <span class="stringliteral">&quot;&quot;</span><span class="stringliteral">&quot;Prepare the &quot;</span>world get &lt;obj&gt; &lt;id&gt;<span class="stringliteral">&quot; command bottle.&quot;</span><span class="stringliteral">&quot;&quot;</span></div>
<div class="line">    result = <a class="code" href="namespaceyarp.html">yarp</a>.Bottle()</div>
<div class="line">    result.clear()</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="namespaceiCub_1_1learningmachine_1_1math.html#a71fd1dc7676d2de7d7ed6617b15e9a5f">map</a>(result.addString, [<span class="stringliteral">&quot;world&quot;</span>, <span class="stringliteral">&quot;get&quot;</span>, obj])</div>
<div class="line">    result.addInt(obj_id)</div>
<div class="line">    </div>
<div class="line">    return result</div>
<div class="line"> </div>
<div class="line">def get_object_location(<a class="code" href="firmwareupdatercore_8cpp.html#a396f1276c4c0cd4c8ea515f853c8494f">self</a>, obj_id):</div>
<div class="line">    <span class="stringliteral">&quot;&quot;</span><span class="stringliteral">&quot;Obtain the object location from the simulator. Returns None on failure.&quot;</span><span class="stringliteral">&quot;&quot;</span></div>
<div class="line">    obj_desc = <a class="code" href="firmwareupdatercore_8cpp.html#a396f1276c4c0cd4c8ea515f853c8494f">self</a>._objects[obj_id]</div>
<div class="line">    result = <a class="code" href="firmwareupdatercore_8cpp.html#a396f1276c4c0cd4c8ea515f853c8494f">self</a>._execute(<a class="code" href="firmwareupdatercore_8cpp.html#a396f1276c4c0cd4c8ea515f853c8494f">self</a>._prepare_get_command(obj_desc[0], obj_desc[1]))</div>
<div class="line">    if result.size() == 3:</div>
<div class="line">        return [ result.get(i).asDouble() for i in xrange(3) ] # 3-element list with xyz coordinates</div>
<div class="line">    else:</div>
<div class="line">        return None # An <a class="code" href="namespaceiCub_1_1action_1_1log.html#a4ba5ea132464d0ea49d618130163c769a41b05ff8216aae3cac29fe50f6db76c0">error</a> occured</div>
</div><!-- fragment --><p>Finally, we need to make sure that after the WorldController is no longer needed, it will clean up stuff after itself:</p>
<div class="fragment"><div class="line">def __del__(<span class="keyword">self</span>):</div>
<div class="line">    try:</div>
<div class="line">        if <a class="code" href="firmwareupdatercore_8cpp.html#a396f1276c4c0cd4c8ea515f853c8494f">self</a>._rpc_client &lt;&gt; None:</div>
<div class="line">            <a class="code" href="firmwareupdatercore_8cpp.html#a396f1276c4c0cd4c8ea515f853c8494f">self</a>.del_all()</div>
<div class="line">        <a class="code" href="firmwareupdatercore_8cpp.html#a396f1276c4c0cd4c8ea515f853c8494f">self</a>._rpc_client.close()</div>
<div class="line">        del <a class="code" href="firmwareupdatercore_8cpp.html#a396f1276c4c0cd4c8ea515f853c8494f">self</a>._rpc_client</div>
<div class="line">    except AttributeError:</div>
<div class="line">        pass</div>
</div><!-- fragment --><p>Now that the WorldController class definition is complete, we can use our module in the following way, for instance from iPython console:</p>
<div class="fragment"><div class="line"><span class="keyword">import</span> <a class="code" href="namespacepython__simworld__control.html">python_simworld_control</a> as psc  # YARP is automatically initalised now</div>
<div class="line"> </div>
<div class="line">wc = psc.<a class="code" href="classpython__simworld__control_1_1WorldController.html">WorldController</a>() # you will see YARP spitting <a class="code" href="sine_8m.html#a2a89187d8e8e8fba509ef9ab5f815d88">out</a> debugging messages as RPC client connects to the server</div>
<div class="line"> </div>
<div class="line"><span class="preprocessor"># Let&#39;s create some objects...</span></div>
<div class="line"> </div>
<div class="line">red_sphere = wc.create_object(<span class="stringliteral">&#39;ssph&#39;</span>, [ 0.1 ], [ -1, 1, 1 ], [ 1, 0, 0 ])</div>
<div class="line">green_box = wc.create_object(<span class="stringliteral">&#39;sbox&#39;</span>, [ 0.2, 0.2, 0.2 ], [ 0, 1, 1 ], [ 0, 1, 0 ])</div>
<div class="line">blue_cylinder = wc.create_object(<span class="stringliteral">&#39;scyl&#39;</span>, [ 0.1, 0.1 ], [ 1, 1, 1 ], [ 0, 0, 1 ])</div>
<div class="line"> </div>
<div class="line"><span class="preprocessor"># ... move them around ...</span></div>
<div class="line"> </div>
<div class="line">wc.move_object(red_sphere, [ 1, 0.5, 1 ])</div>
<div class="line">wc.move_object(green_box, [ -1, 0.5, 1 ])</div>
<div class="line">wc.move_object(blue_cylinder, [ 0, 0.5, 1 ])</div>
<div class="line"> </div>
<div class="line"><span class="preprocessor"># ... and ask for their positions ...</span></div>
<div class="line"> </div>
<div class="line"><a class="code" href="namespaceeth_1_1parser.html#ac2f5662a765ffbe9a0790ca81c24a838">print</a> wc.get_object_location(green_box)</div>
<div class="line"> </div>
<div class="line"><span class="preprocessor"># Now let&#39;s cleanup</span></div>
<div class="line"> </div>
<div class="line">wc.del_all()</div>
<div class="line"> </div>
<div class="line"><span class="preprocessor"># No, wait, I want more!</span></div>
<div class="line"> </div>
<div class="line">monolith = wc.create_object(<span class="stringliteral">&#39;sbox&#39;</span>, [ 0.8, 1.8, 0.2 ], [ 0, 0.9, 1 ], [ 0, 0, 0 ])</div>
<div class="line"> </div>
<div class="line"><span class="preprocessor"># OK, this time we&#39;re done for good - delete the wc object, what will invoke its destructor</span></div>
<div class="line"> </div>
<div class="line">del wc</div>
<div class="ttc" id="aclasspython__simworld__control_1_1WorldController_html"><div class="ttname"><a href="classpython__simworld__control_1_1WorldController.html">python_simworld_control.WorldController</a></div><div class="ttdef"><b>Definition:</b> <a href="python__simworld__control_8py_source.html#l00007">python_simworld_control.py:7</a></div></div>
<div class="ttc" id="anamespaceeth_1_1parser_html_ac2f5662a765ffbe9a0790ca81c24a838"><div class="ttname"><a href="namespaceeth_1_1parser.html#ac2f5662a765ffbe9a0790ca81c24a838">eth::parser::print</a></div><div class="ttdeci">bool print(const pc104Data &amp;pc104data)</div><div class="ttdef"><b>Definition:</b> <a href="ethParser_8cpp_source.html#l00057">ethParser.cpp:57</a></div></div>
<div class="ttc" id="anamespacepython__simworld__control_html"><div class="ttname"><a href="namespacepython__simworld__control.html">python_simworld_control</a></div><div class="ttdef"><b>Definition:</b> <a href="python__simworld__control_8py_source.html#l00001">python_simworld_control.py:1</a></div></div>
<div class="ttc" id="asine_8m_html_a2a89187d8e8e8fba509ef9ab5f815d88"><div class="ttname"><a href="sine_8m.html#a2a89187d8e8e8fba509ef9ab5f815d88">out</a></div><div class="ttdeci">out</div><div class="ttdef"><b>Definition:</b> <a href="sine_8m_source.html#l00008">sine.m:8</a></div></div>
</div><!-- fragment --><p>This file can be edited at <a class="el" href="python-simworld-control_8dox.html">doc/python-simworld-control.dox</a> </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Tue Mar 26 2024 16:02:19 for iCub-main by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
