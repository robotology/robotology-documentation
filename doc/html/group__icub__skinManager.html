<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>iCub-main: skinManager</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">iCub-main
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">skinManager<div class="ingroups"><a class="el" href="group__icub__modules__all.html">Software</a> &raquo; <a class="el" href="group__icub__module.html">iCub modules</a></div></div>  </div>
</div><!--header-->
<div class="contents">

<p>This module reads the raw tactile sensor values, compensates for the (thermal) drift of the sensors (basically it is a high pass filter) and writes the compensated values on output ports.  
</p>
<div id="dynsection-0" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-0-trigger" src="closed.png" alt="+"/> Collaboration diagram for skinManager:</div>
<div id="dynsection-0-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-0-content" class="dyncontent" style="display:none;">
<div class="center"><img src="group__icub__skinManager.png" border="0" usemap="#agroup____icub____skinManager" alt=""/></div>
<map name="agroup____icub____skinManager" id="agroup____icub____skinManager">
<area shape="rect" title="This module reads the raw tactile sensor values, compensates for the (thermal) drift of the sensors (..." alt="" coords="164,5,271,31"/>
<area shape="rect" href="group__icub__module.html" title="This is the list of iCub modules, i.e." alt="" coords="5,5,116,31"/>
</map>
</div>
<p>This module reads the raw tactile sensor values, compensates for the (thermal) drift of the sensors (basically it is a high pass filter) and writes the compensated values on output ports. </p>
<p>The module can manage many input ports at the same time (see parameter "inputPorts"). For each input port the compensated tactile data are written on the corresponding output port (see parameter "outputPorts"). Optionally, the module also can apply a smoothing filter (low pass filter) and/or a binarization filter to the data. The skinManagerGui can be used to control and monitor an instance of the skinManager module. If the 3d position of the tactile sensors is provided, then this module computes the skinContacts (see library skinDynLib), which can be used by <a class="el" href="group__wholeBodyDynamics.html">wholeBodyDynamics</a> to compute the contact forces.</p>
<h1><a class="anchor" id="intro_sec"></a>
Description</h1>
<p>When launched the module executes the skin sensor calibration, assuming that the sensors are not in contact with anything during this phase. The calibration resets the taxel baselines, gathers the sensor data for 5 sec, computes the mean (i.e. the baseline) and the 95 percentile (i.e. the touch threshold) for every taxel.</p>
<p>After the calibration the module starts reading the raw data, computing the difference between the read values and the baseline, and outputs the results. If no touch is detected (i.e. the compensated values are under the touch threshold) then the baseline is updated in order to follow the drift (if any).</p>
<p>The binarization filter is really simple. Every taxel has a touch threshold, given by its 95% percentile plus a safety threshold (2 by default). If the read value is greater than the corrisponding touch threshold the output is set to 100, otherwise to 0. The binarization filter can be used for stressing the touch detection, especially in cases where the touch is very light.</p>
<p>The smoothing filter performs an exponential moving average in order to reduce the sensor noise. The intensity of the filter can be tuned by setting the parameter alpha, also called "smoothing factor". The smoothed output is a weighted average of the current input and the previous output: y(t) = (1-alpha)*x(t) + alpha*y(t-1)</p>
<p>If the module is properly configured then it performs contact clustering, that is it determines how many contacts are detected by the tactile sensors. When tactile sensors that are neighbors detect contact, they are clustered together. When tactile sensors that are not neighbors detect contact, they are considered as independent contacts. The result of this operation is a skinContactList (see skinDynLib) that is written on the output port "\moduleName\skin_events:o". Tipically this port is connected to an input port of the module <a class="el" href="group__wholeBodyDynamics.html">wholeBodyDynamics</a> which uses this data to estimate the contact forces.</p>
<h1><a class="anchor" id="lib_sec"></a>
Libraries</h1>
<p>YARP.</p>
<h1><a class="anchor" id="parameters_sec"></a>
Parameters</h1>
<p><b>Command-line Parameters</b></p>
<p>The following key-value pairs can be specified as command-line parameters by prefixing &ndash; to the key (e.g. &ndash;from file.ini). The value part can be changed to suit your needs; the default values are shown below.</p><ul>
<li><code>from</code> <code></code>[driftCompLeft.ini] <br  />
 specifies the configuration file</li>
<li><code>context</code> <code></code>[skinGui] <br  />
 specifies the sub-path from <code>$ICUB_ROOT/app</code> to the configuration file</li>
<li><code>name</code> <code></code>[skinManager] <br  />
 <br  />
 specifies the name of the module (used to form the stem of module port names) <br  />
</li>
<li><code>robot</code> <code></code>[icub] <br  />
 <br  />
 specifies the name of the robot (used only to distiguish the simulator and the real robot)</li>
</ul>
<p><b>Configuration File Parameters </b></p>
<p>The following key-value pairs can be specified as parameters in the configuration file (they can also be specified as command-line parameters if you so wish). The value part can be changed to suit your needs; the default values are shown below.</p><ul>
<li><code>inputPorts</code> <code></code>[emptyList] <br  />
 list of the input ports from which the module has to read the tactile data. For each input port there has to be a corresponding output port specified in the "outputPorts" parameter.</li>
<li><code>outputPorts</code> <code></code>[emptyList] <br  />
 list of the output ports on which the module has to write the compensated tactile data. For each output port there has to be a corresponding input port specified in the "inputPorts" parameter.</li>
<li><code>period</code> <code></code>[20] <br  />
 period of the compensating thread expressed in ms.</li>
<li><code>minBaseline</code> <code></code>[3] <br  />
 <br  />
 if the baseline of one sensor (at least) reaches this value, then a warning message is sent on the info output port.</li>
<li><code>zeroUpRawData</code> <code></code>[false] <br  />
 if true the input tactile data are considered from zero up, otherwise from 255 down</li>
<li><code>binarization</code> <code></code>[not active]<br  />
 if specified the output tactile data are binarized: 0 indicates no touch, whereas 100 indicates touch</li>
<li><code>smoothFilter</code> <code></code>[not active]<br  />
 if specified the output tactile data are filtered with an exponential moving average (where alpha is the smooth factor): \t- y(t) = (1-alpha)*x(t) + alpha*y(t-1)</li>
<li><code>smoothFactor</code> <code></code>[0.5] <br  />
 alpha value of the smoothing filter, in [0, 1] where 0 is no smoothing at all and 1 is the max smoothing possible.</li>
</ul>
<p>An optional section called SKIN_EVENTS may be specified in the configuration file. These are the parameters of this section:</p><ul>
<li><code>bodyParts</code> <code></code>[emptyList] <br  />
 list of the body parts corresponding to the specified inputPorts (see common.h in skinDynLib for the definition of BodyPart). For each input port there has to be a body part, e.g. UNKNOWN_BODY_PART, HEAD, TORSO, LEFT_ARM, RIGHT_ARM, LEFT_LEG, RIGHT_LEG.</li>
<li><code>skinParts</code> <code></code>[emptyList] <br  />
 list of the skin part corresponding to the specified inputPorts (see skinDynLib for the definition of SkinPart). For each input port there has to be a skin part, e.g. UNKNOWN_SKIN_PART, HAND, FOREARM, UPPER_ARM.</li>
<li><code>linkList</code> <code></code>[emptyList] <br  />
 list of the link number corresponding to the specified inputPorts. For each input port there has to be a link number (2: upperArm link, 4: forearm link, 6: hand link).</li>
<li><code>taxelPositionFiles</code> [emptyList] <br  />
 list of the files containing the 3D positions and orientations of the tactile sensors for each input port. The files contains a set of parameters used for configuring the correspondent skinPart (<a class="el" href="classiCub_1_1skinDynLib_1_1skinPart.html" title="Class that encloses everything relate to a skinPart.">iCub::skinDynLib::skinPart</a> , see skinDynLib for a definition of this class). Further, there is a group called [calibration] containing one line for each tactile sensor. In each line there are 6 values, the first three are the position, the last three are the orientation. For each input port there has to be a taxel position file (which may not exist because of missing calibration procedure for that skin part).</li>
<li><code>maxNeighborDist</code> <code>0.015</code> <br  />
 maximum distance between two neighbor tactile sensors (in meters).</li>
</ul>
<h1><a class="anchor" id="portsa_sec"></a>
Ports Accessed</h1>
<p>All the ports listed in the "inputPorts" parameter and the corresponding rpc ports. For instance if in the "inputPorts" parameter it is specified the port</p><ul>
<li>/icub/skin/right_hand</li>
</ul>
<p>then also the port</p><ul>
<li>/icub/skin/right_hand/rpc:i</li>
</ul>
<p>will be accessed.</p>
<h1><a class="anchor" id="portsc_sec"></a>
Ports Created</h1>
<p><b>Output ports </b></p><ul>
<li>Every port specified in the "outputPorts" parameter: outputs a yarp::sig::Vector containing the compensated tactile data.</li>
<li>"/"+moduleName+"/monitor:o": <br  />
 outputs a yarp::os::Bottle containing streaming information regarding the compensation status (used to communicate with the skinManagerGui). The first value is the data frequency, while all the following ones represent the drift compensated so far for each taxel.</li>
<li>"/"+moduleName+"/info:o": <br  />
 outputs a yarp::os::Bottle containing occasional information regarding the compensation status such as warning or error messages (used to communicate with the skinManagerGui). Possible messages may regard an error in the sensor reading or an excessive drift of the baseline of a taxel.<br  />
</li>
<li>"/"+moduleName+"/skin_events:o": <br  />
 outputs a <a class="el" href="classiCub_1_1skinDynLib_1_1skinContactList.html" title="Class representing a list of external contacts acting on the iCub&#39; skin.">iCub::skinDynLib::skinContactList</a> containing the list of contacts.</li>
</ul>
<p><b>Input ports</b></p><ul>
<li>For each port specified in the "inputPorts" parameter a local port is created with the name "/"+moduleName+index+"/input", where "index" is an increasing counter starting from 0.</li>
<li>"/"+moduleName+"/rpc:i": input port to control the module (alternatively the skinManagerGui can be used). This port accepts a yarp::os::yarp::os::Bottle that contains one of these commands:<ul>
<li>"calib": force the sensor calibration</li>
<li>"get touch thr": return a yarp::os::yarp::os::Bottle containing the 95 percentile values of the tactile sensors</li>
<li>"set binarization": enable or disable the binarization (specifying the value on/off)</li>
<li>"get binarization": get the binarization filter state (on, off)</li>
<li>"set smooth filter": enable or disable the smooth filter (specifying the value on/off)</li>
<li>"get smooth filter": get the smooth filter state (on, off)</li>
<li>"set smooth factor": set the value of the smooth factor (in [0,1])</li>
<li>"get smooth factor": get the smooth factor value</li>
<li>"set threshold": set the safety threshold that is added to the touch thresholds (int in [0, 254])</li>
<li>"get threshold": get the safety threshold that is added to the touch thresholds (int in [0, 254])</li>
<li>"set gain": set the compensation gain</li>
<li>"get gain": get the compensation gain</li>
<li>"set contact gain": set the contact compensation gain</li>
<li>"get contact gain": get the contact compensation gain</li>
<li>"is calibrating": tell whether the skin calibration is in progress</li>
<li>"get pose": get taxel pose(s) with input params: body part, skin part, taxel index (if taxel index is not specified return all taxel positions),</li>
<li>"set pose": set taxel pose(s) with input params: body part, skin part, taxel index, pose(s) (if taxel index is not specified set all taxel positions),</li>
<li>"get info": get information about the module (module name, robot name, input ports, num of taxels)</li>
<li>"help": get a list of the commands accepted by this module</li>
<li>"quit": quit the module</li>
</ul>
</li>
</ul>
<p>All the commands accepted by this module are defined in rpcSkinManager.h .</p>
<h1><a class="anchor" id="in_files_sec"></a>
Input Data Files</h1>
<p>None.</p>
<h1><a class="anchor" id="out_data_sec"></a>
Output Data Files</h1>
<p>None.</p>
<h1><a class="anchor" id="conf_file_sec"></a>
Configuration Files</h1>
<p>None.</p>
<h1><a class="anchor" id="tested_os_sec"></a>
Tested OS</h1>
<p>Linux and Windows.</p>
<h1><a class="anchor" id="example_sec"></a>
Example Instantiation of the Module</h1>
<p>skinManager &ndash;context skinGui &ndash;from driftCompRight.ini</p>
<dl class="section author"><dt>Author</dt><dd>Andrea Del Prete (<a href="#" onclick="location.href='mai'+'lto:'+'and'+'re'+'a.d'+'el'+'pre'+'te'+'@ii'+'t.'+'it'; return false;">andre<span style="display: none;">.nosp@m.</span>a.de<span style="display: none;">.nosp@m.</span>lpret<span style="display: none;">.nosp@m.</span>e@ii<span style="display: none;">.nosp@m.</span>t.it</a>), Alexander Schmitz, Francesco Giovannini (<a href="#" onclick="location.href='mai'+'lto:'+'fra'+'nc'+'esc'+'o.'+'gio'+'va'+'nni'+'ni'+'@ii'+'t.'+'it'; return false;">franc<span style="display: none;">.nosp@m.</span>esco<span style="display: none;">.nosp@m.</span>.giov<span style="display: none;">.nosp@m.</span>anni<span style="display: none;">.nosp@m.</span>ni@ii<span style="display: none;">.nosp@m.</span>t.it</a>)</dd></dl>
<p>Copyright (C) 2010 RobotCub Consortium</p>
<p>CopyPolicy: Released under the terms of the GNU GPL v2.0.</p>
<p>This file can be edited at ICUB_HOME/main/src/modules/skinManager/include/iCub/skinManager/skinManager.h. </p>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Tue Mar 26 2024 16:02:19 for iCub-main by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
