<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>iCub-main: A short introduction to iDyn</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">iCub-main
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">A short introduction to iDyn </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>iDyn is a library for computing kinematics and dynamics of serial-links chains of revolute joints and <a class="el" href="namespaceiCub.html" title="This file contains the definition of unique IDs for the body parts and the skin parts of the robot.">iCub</a> limbs.</p>
<p>It started as an extension of the iKin library, with the purpose of including the dynamic description of the links, and gradually evolved until considering the whole body dynamics. Thus, starting from links (from iKinLink to iDynLink) the library provides classes for links, chain of links, and generic limbs. Of course, <a class="el" href="namespaceiCub.html" title="This file contains the definition of unique IDs for the body parts and the skin parts of the robot.">iCub</a> limbs are included, with the specific kinematics and dynamics data already set (by default, the CAD parameters).</p>
<p>The library also provides a Newton-Euler based method to compute forces, moments, and joint torques, for each link in single or multiple interconnected chains, in presence or not of FT sensors, placed anywhere in the chain (e.g. in the middle of the chain).</p>
<p>The main purposes of the library are:</p>
<ul>
<li>computation of all <a class="el" href="namespaceiCub.html" title="This file contains the definition of unique IDs for the body parts and the skin parts of the robot.">iCub</a> joint torques</li>
<li>computation of external wrenches acting at the end-effector of the arms/legs of <a class="el" href="namespaceiCub.html" title="This file contains the definition of unique IDs for the body parts and the skin parts of the robot.">iCub</a></li>
</ul>
<p>The modules using iDyn and performing these operations are WholeBodyTorqueObserver  and WrenchObserver, which are the bases for the Torque Interface, Torque Control, Impedance Control, Zero-force control, external contact detection and so on. The complete and detailed documentation of iDyn code is available <a class="el" href="group__iDyn.html">here</a>.</p>
<h1><a class="anchor" id="sec_library_modules"></a>
Library modules</h1>
<p>The library modules are:</p>
<ul>
<li>RecursiveNewtonEuler: force/torque computation in a chain using Newton-Euler recursive formulation, both in the forward/backward sense</li>
<li>iDynInv: estimation of force/moment measured by a virtual FT sensor placed everywhere in a chain</li>
<li>iDynFwd: retrieve joint torques of limbs with single FT sensor measurements</li>
<li>iDynBody: whole body dynamics, i.e. interconnection of multiple chains</li>
<li>iTransform: projection of forces along the chain <br  />
</li>
</ul>
<h1><a class="anchor" id="sec_core"></a>
Core classes</h1>
<p>The base classes describing serial links chains are:</p>
<ul>
<li>iDynLink: a link with kinematic and dynamic characteristics</li>
<li>iDynChain: a chain of serial links, with kinematic and dynamic properties</li>
<li>iDynLimb: a generic limb, described by a chain</li>
</ul>
<p>Note that iDynLink and iDynChain are derived from the corresponding classes (iKinLink and iKinChain) in the iKin library, so they provide both kinematic and dynamic data and methods. iDynLimb is, as in iKin, basically a redefinition of iDynChain methods, used to protect some chain data. iDynLink is an extension of iKinLink, since it adds the dynamic parameters of the link:</p>
<ul>
<li>\( H_C \) (HC,COM) : the center of mass, i.e. a roto-translational matrix defining the COM with respect to the link frame</li>
<li>\( m \) (m): the link mass, concentrated in the COM</li>
<li>\( I \) (I): the inertia matrix of the link</li>
</ul>
<p>and the other characteristic variables used for dynamics:</p>
<ul>
<li>\( \dot{q},\ddot{q} \) (dq/dAng, ddq/d2q/d2Ang) : joint velocity &amp; acceleration</li>
<li>\( w, \dot{w} \) (w,dw): link angular velocity &amp; acceleration</li>
<li>\( \ddot{p},\ddot{p}_C \) (ddp,ddpC): link and its COM linear acceleration</li>
<li>\( f, \mu \) (F, Mu): link force, moment</li>
<li>\( \tau \) (Tau): joint torque <br  />
</li>
</ul>
<p>An iDynChain is basically a list of links; the main difference with respect to iKin is that blocked links contribute to the dynamics, so there's no need to have a second list to fasten dynamic computations. However, since iDynChain inherits from iKinChain, blocked links are considered for the Jacobian computation, which is unchanged. One of the advantages of iDyn is the possibility to interconnect multiple limbs and computing also a "shared" Jacobian. To this purpose, the concept of "node" must be introduced.</p>
<p>iDynNode represents a virtual node where multiple limbs are connected, and may exchange kinematic and wrench information among them. Multiple limbs can be attached to the Node, but at least one must be attached.</p>
<p>The mutual exchange between node and limbs (full duplex) is managed used a RigidBodyTransformation class, containing the roto-translational matrix which describes the connection, and the type of `&lsquo;flow&rsquo;' of kinematic and wrench variables: from limb to node or from node to limb. One limb can be attached to a node at the base or at the end-effector: this, combined with the information flows, affects the computations in particular the application of the Newton-Euler algorithm while solving the limbs dynamic.</p>
<p>If a FT sensor is present inside a kinematic chain, its measurements can be exploited to initialize the wrench phase of the Newton-Euler recursive algorithm, starting from the sensor instead of the end-effector of the chain (or the final link of the chain). A iDynSensor class is then used: a generic class, which attaches a FT sensor into a iDynChain. The `&lsquo;attach&rsquo;' is specified by the \( s-th \) link hosting the sensor, the roto-translational matrix defining the sensor frame with respect to the link frame, and the dynamical parameters of the "sub-link" between the link frame and the sensor frame (the portion of link between the sensor and the end of the link).</p>
<h1><a class="anchor" id="sec_icub_limbs"></a>
iCub limbs</h1>
<p>iDyn is a generic library that could be used for any robot, but of course <a class="el" href="namespaceiCub.html" title="This file contains the definition of unique IDs for the body parts and the skin parts of the robot.">iCub</a> parts/limbs are already available to the user, pre-configured with the <a class="el" href="namespaceiCub.html" title="This file contains the definition of unique IDs for the body parts and the skin parts of the robot.">iCub</a> CAD parameters. A generic <a class="el" href="namespaceiCub.html" title="This file contains the definition of unique IDs for the body parts and the skin parts of the robot.">iCub</a> limb name is: <a class="el" href="namespaceiCub.html" title="This file contains the definition of unique IDs for the body parts and the skin parts of the robot.">iCub</a> + part + Dyn where part is: Arm, Torso, Leg, Eye, EyeNeckRef, InertialSensor, NeckInertial. For legs and arms the part can be also followed by the tag "NoTorso": the reason is that in iKin the arm limb includes the torso links in the chain, whereas in iDyn one may choose to work on the arm only; in a similar way, legs in iKin are referred to the torso \(H_0\) matrix, whereas in iDyn one can choose to have them without reference to the torso.</p>
<div class="image">
<img src="icub_limbs.png" alt=""/>
</div>
<h1><a class="anchor" id="sec_using_idyn"></a>
Using iDyn</h1>
<p>In order to use the iDyn library, make sure that the following steps are done: <br  />
</p><ol type="1">
<li>Update YARP and <a class="el" href="namespaceiCub.html" title="This file contains the definition of unique IDs for the body parts and the skin parts of the robot.">iCub</a> repositories.</li>
<li>Compile YARP and <a class="el" href="namespaceiCub.html" title="This file contains the definition of unique IDs for the body parts and the skin parts of the robot.">iCub</a> (always a good practice).</li>
<li>Try first the tutorial examples, located in <div class="fragment"><div class="line">icub-tutorials/src/iDyn</div>
</div><!-- fragment --></li>
</ol>
<p>iDyn depends only on YARP and iKin. In order to include iDyn and use it in your software, make sure you include the following line in the <em>CMakeLists.txt</em>: </p><div class="fragment"><div class="line">TARGET_LINK_LIBRARIES(${PROJECTNAME} ... iDyn ...)</div>
</div><!-- fragment --><p> Of course if you are developing outside the <a class="el" href="namespaceiCub.html" title="This file contains the definition of unique IDs for the body parts and the skin parts of the robot.">iCub</a> project (e.g. in contrib), you may also add these lines: </p><div class="fragment"><div class="line">FIND_PACKAGE(YARP)</div>
<div class="line">FIND_PACKAGE(ICUB)</div>
</div><!-- fragment --><p>In your code the iDyn namespace must be declared, and the header files needed must be included: </p><div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="iDyn_8h.html">iCub/iDyn/iDyn.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="iDynInv_8h.html">iCub/iDyn/iDynInv.h</a>&gt;</span></div>
<div class="line">...</div>
<div class="line">using <span class="keyword">namespace </span><a class="code" href="namespaceiCub_1_1iDyn.html">iCub::iDyn</a>;</div>
<div class="ttc" id="aiDynInv_8h_html"><div class="ttname"><a href="iDynInv_8h.html">iDynInv.h</a></div></div>
<div class="ttc" id="aiDyn_8h_html"><div class="ttname"><a href="iDyn_8h.html">iDyn.h</a></div></div>
<div class="ttc" id="anamespaceiCub_1_1iDyn_html"><div class="ttname"><a href="namespaceiCub_1_1iDyn.html">iCub::iDyn</a></div><div class="ttdef"><b>Definition:</b> <a href="iDyn_8h_source.html#l00081">iDyn.h:82</a></div></div>
</div><!-- fragment --><h1><a class="anchor" id="sec_notes_newton_euler"></a>
Basic Newton-Euler algorithm</h1>
<p>The Newton-Euler recursive algorithm is basically a set of computations, consisting in two steps: the so called "kinematic" and "wrench phase". In the first, the kinematic variables of the link (angular velocity/acceleration, linear acceleration, and so on) are computed, whereas in the latter the force, moment and joint torque are computed. Both phases must be initialized properly, with kinematic information (usually at the base of the chain) and external wrench information (usually at the end-effector of the chain).</p>
<p><b>Classic Newton-Euler computations</b></p>
<p>Kinematic phase (Forward): \( i=1,2,\ldots,n \)</p>
<p class="formulaDsp">
\[ w^i_i = {R^{i-1}_i}^\top (w^{i-1}_{i-1} + \dot{\theta}_i z_0) \]
</p>
 <p class="formulaDsp">
\[ \dot{w}^i_i = {R^{i-1}_i}^\top (\dot{w}^{i-1}_{i-1} + \ddot{\theta}_i z_0 + \dot{\theta}_i w^{i-1}_{i-1} \times z_0) \]
</p>
 <p class="formulaDsp">
\[ \ddot{p}^i_i = {R^{i-1}_i}^\top \ddot{p}^{i-1}_{i-1} + \dot{w}^i_i \times r^i_{i-1,i} + w^i_i \times (w^i_i \times r^i_{i-1,i}) \]
</p>
 <p class="formulaDsp">
\[ \ddot{p}^i_{C_i} = \ddot{p}^i_i + \dot{w}^i_i \times r^i_{i,C_i} + w^i_i \times (w^i_i \times r^i_{i,C_i}) \]
</p>
<p>initialized by \( w^0_0, \dot{w}^0_0, \ddot{p}^0_0-g^0_0 \).</p>
<p>Wrench phase (Backward): \( i=n,n-1,\ldots,1 \)</p>
<p class="formulaDsp">
\[ f^i_i = {R^{i}_{i+1}}^\top f^{i+1}_{i+1} + m_i \ddot{p}^i_{C_i} \]
</p>
 <p class="formulaDsp">
\[ \mu^i_i = - f^i_i \times ( r^i_{i-1,i} + r^i_{i,C_i} ) + R^i_{i+1} \mu^{i+1}_{i+1} + R^i_{i+1} f^{i+1}_{i+1} \times r^i_{i,C_i} + \bar{I}^i_i \dot{w}^i_i + w^i_i \times (\bar{I}^i_i w^i_i) \]
</p>
 <p class="formulaDsp">
\[ \tau_i = {\mu^i_i}^\top {R^{i-1}_i}^\top z_0 \]
</p>
<p>initialized by \( f^{n+1}_{n+1},\mu^{n+1}_{n+1} \).</p>
<p>The detailed description of the algorithm can be found in: <em>L. Sciavicco, B. Siciliano, Modelling and Control of Robot Manipulators, 2nd Edition, Springer-Verlag, 2000.</em></p>
<p><b>Note</b></p>
<p>iDyn provides Newton-Euler recursive algorithm computations for the classical case, but also for all possible cases, i.e. when the external kinematic and wrench information are set at the beginning or at the end of the chain, or whenever external force measurements (coming from a FT sensor inside the chain) are available.</p>
<h1><a class="anchor" id="sec_more_info"></a>
More about iDyn</h1>
<p>A more detailed description of the library, along with tutorial slides, is available in the <a href="http://wiki.icub.org/wiki/iDyn">wiki page on iDyn</a>.</p>
<p>Some working examples are available under </p><div class="fragment"><div class="line">icub-tutorials/src/iDyn</div>
</div><!-- fragment --><p>The detailed code documentation is available <a class="el" href="group__iDyn.html">here</a>.</p>
<dl class="section author"><dt>Author</dt><dd>Serena Ivaldi </dd></dl>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Tue Mar 26 2024 16:02:19 for iCub-main by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
