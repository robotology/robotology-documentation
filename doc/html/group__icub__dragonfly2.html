<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>iCub-main: dragonfly2</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">iCub-main
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">dragonfly2<div class="ingroups"><a class="el" href="group__icub__modules__all.html">Software</a> &raquo; <a class="el" href="group__icub__mod__library.html">iCub YARP devices library</a> &raquo; <a class="el" href="group__icub__hardware__modules.html">Hardware YARP devices</a></div></div>  </div>
</div><!--header-->
<div class="contents">

<p>The dragonfly2 framegrabber device driver can acquire RGB color images in 320x240 or 640x480 resolutions.  
</p>
<div id="dynsection-0" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-0-trigger" src="closed.png" alt="+"/> Collaboration diagram for dragonfly2:</div>
<div id="dynsection-0-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-0-content" class="dyncontent" style="display:none;">
<div class="center"><img src="group__icub__dragonfly2.png" border="0" usemap="#agroup____icub____dragonfly2" alt=""/></div>
<map name="agroup____icub____dragonfly2" id="agroup____icub____dragonfly2">
<area shape="rect" title="The dragonfly2 framegrabber device driver can acquire RGB color images in 320x240 or 640x480 resoluti..." alt="" coords="229,5,320,31"/>
<area shape="rect" href="group__icub__hardware__modules.html" title="YARP devices that provide access to the robot hardware." alt="" coords="5,5,181,31"/>
</map>
</div>
<p>The dragonfly2 framegrabber device driver can acquire RGB color images in 320x240 or 640x480 resolutions. </p>
<p>The dragonfly2raw framegrabber device driver can acquire raw format images in 640x480 resolution.</p>
<h1><a class="anchor" id="intro_sec"></a>
Description</h1>
<p>The dragonfly framegrabber device driver is based on libdc1394-2.</p>
<p>It can acquire RGB color images in 320x240 or 640x480 resolutions. In 640x480 there are two options: Bayer decoding performed on board by the camera or Bayer pattern decoding performed by the driver. In the second mode the bandwidth required to the Firewire bus is lower, and thus the framerate can be up to 60 fps. In the first mode the framerate is limited to 15 fps with two cameras on the same channel. Moreover, once the resolution is chosen, the image can be cropped on board by the camera before the transfer on the Firewire bus.</p>
<p>These functionalities are made available thought two YARP devices: dragonfly2 (for RGB images) and dragondly2raw (for raw images with Bayer encoding).</p>
<p>Runtime parameters can be changed using the graphical interface: icub_framegrabbergui2.</p>
<h1><a class="anchor" id="lib_sec"></a>
Libraries</h1>
<p>libdc1394-2 (Linux) PGRFlyCapture (Windows)</p>
<h1><a class="anchor" id="parameters_sec"></a>
Parameters</h1>
<p>&ndash;name // image output port</p>
<p>&ndash;video_type // 1: RGB 320x240, 2: RGB 640x480, 3: RGB 640x480 (default) software Bayer decoding (higher fps)</p>
<p>&ndash;width|size_x // width image cropping (limited to image size)</p>
<p>&ndash;height|size_y // height image cropping (limited to image size)</p>
<p>&ndash;port_number // Firewire channel (need to specify only if you have more than one firewire card)</p>
<p>&ndash;guid // camera global unique 64 bit identifier <b>WARNING: replaces &ndash;d</b></p>
<p>&ndash;d // camera unit number <b>DEPRECATED</b></p>
<p>&ndash;white_balance // red and blue balance, values are normalized betwen 0.0 and 1.0</p>
<p>&ndash;feature // camera feature setting, normalized between 0.0 and 1.0 (features listed below)</p>
<h2><a class="anchor" id="video_type"></a>
The video_type parameter</h2>
<p>The video_type parameter determines how images are acquired by the dragonfly chip.</p>
<p>-video_type 1: the image is acquired by the Dragonfly2 camera in 320x240 resolution as RGB color image, and transferred to the framegrabber driver memory buffer in this format. The Firewire bandwidth allows maximum framerate (60 fps) with two cameras. If specified, the &ndash;width and &ndash;height parameters will '''crop''' the image to the specified dimension.</p>
<p>-video_type 2: the image is acquired by the Dragonfly2 camera in 640x480 resolution as RGB color image, and transferred to the framegrabber driver memory buffer in this format. The Firewire bandwidth allows 15 fps with two cameras. If specified, the &ndash;width and &ndash;height parameters will '''crop''' the image to the specified dimension.</p>
<p>-video_type 3: the image is acquired as a raw Bayer pattern 640x480 image, and transferred in this format to the framegrabber driver memory buffer. In this way, the bandwidth required to the Firewire bus is lower than in the previous format, allowing 60 fps. The Bayer decoding to the usual RGB format provided by the DragonflyDeviceDriver2 framegrabber is performed at software level by the driver itself. If specified, the &ndash;width and &ndash;height parameters will '''crop''' the original 640 x 480 image to the specified dimension.</p>
<h2><a class="anchor" id="port_units"></a>
Port, Unit number and 64 bit Global Unique Identifier</h2>
<p>Many cameras can coexist on the same Firewire bus (port), sharing the available bandwidth. Each camera connected to the same Firewire bus is associated to a unit number. Port numbers, as well as unit numbers, are assigned increasingly starting from 0. The <a class="el" href="namespaceiCub.html" title="This file contains the definition of unique IDs for the body parts and the skin parts of the robot.">iCub</a> robot has one only Firewire card, and thus its port number is always 0 (can be omitted). The two left and right cameras will be unit 0 and 1, but unfortunately this association is not deterministic, and thus the Global Unique Identifier (guid) must be used in order to univokely identify a camera. The yarpdev device driver supports configuration files, thus the most convenient way to deal with GUIDs is putting them in .ini files that will be passed to yarpdev together with all the other parameters as follows:</p>
<p>yarpdev &ndash;from camera/dragonfly2_config_left.ini yarpdev &ndash;from camera/dragonfly2_config_right.ini</p>
<p>In the latest <a class="el" href="namespaceiCub.html" title="This file contains the definition of unique IDs for the body parts and the skin parts of the robot.">iCub</a> software releases the .ini files are already supplied in <b>app/robots/iCubXXXnn/camera</b> folders. The &ndash;d option must be replaced in them by assigning the guid of the corresponding camera to the guid parameter. The following configuration file dragonfly2_config_left.ini</p>
<p>device grabber <br  />
subdevice dragonfly2 <br  />
width 320 <br  />
height 240 <br  />
video_type 1 <br  />
white_balance 0.506 0.494 <br  />
gain 0.312 <br  />
shutter 0.913 <br  />
name /icub/cam/left <br  />
brightness 0 <br  />
DR2 <br  />
stamp <br  />
sharpness 0.5 <br  />
hue 0.48 <br  />
gamma 0.4 <br  />
saturation 0.271 <br  />
framerate 30 <br  />
d 0 <br  />
#guid &lt;64bit global identifier, without the leading 0x&gt; then remove the d option <br  />
 will become after configuration, if (for example) A0BB98F34560AAB5 is the guid of the left camera:</p>
<p>device grabber <br  />
subdevice dragonfly2 <br  />
width 320 <br  />
height 240 <br  />
video_type 1 <br  />
white_balance 0.506 0.494 <br  />
gain 0.312 <br  />
shutter 0.913 <br  />
name /icub/cam/left <br  />
brightness 0 <br  />
DR2 <br  />
stamp <br  />
sharpness 0.5 <br  />
hue 0.48 <br  />
gamma 0.4 <br  />
saturation 0.271 <br  />
framerate 30 <br  />
guid A0BB98F34560AAB5 <br  />
 The configuration files already present in the /app/robots/iCubXXXnn/camera folder are:</p>
<p>dragonfly_config_left.ini <br  />
dragonfly_config_right.ini <br  />
dragonfly_config_left_bayer_320_240.ini <br  />
dragonfly_config_right_bayer_320_240.ini <br  />
dragonfly_config_left_bayer_640_480.ini <br  />
dragonfly_config_right_bayer_640_480.ini <br  />
 </p>
<h2><a class="anchor" id="how_to_guid"></a>
How to obtain GUID from a camera</h2>
<p>Execute from terminal:</p>
<p>yarpdev &ndash;device grabber &ndash;subdevice dragonfly 2 &ndash;name /foocam0 &ndash;d 0</p>
<p>The driver will answer something like:</p>
<p>---&mdash; Camera information ---&mdash; <br  />
Vendor : Point Grey Research <br  />
Model : Dragonfly2 DR2-03S2C-EX <br  />
Unit : 0 <br  />
Specifications ID : 0xa02d <br  />
Software revision : 0x102 <br  />
IIDC version code : 548 <br  />
Unit directory offset : 0x428 <br  />
Unit dependent directory offset : 0x440 <br  />
Commands registers base : 0xf00000 <br  />
Unique ID : 0x00b09d01006fb1fb <b>&lt;== THIS IS THE INFORMATION THAT YOU NEED!!!</b> <br  />
Vendor ID : 0xb09d <br  />
Model ID : 0x1 <br  />
Advanced features found at offset : 0xf01000 <br  />
1394b mode capable (&gt;=800Mbit/s) : Yes <br  />
Platform backend : juju <br  />
---&mdash; Camera platform-specific information ---&mdash; <br  />
Device filename : /dev/fw2 <br  />
 Now, from another terminal, execute</p>
<p>yarpview &ndash;name /fooview0 <br  />
yarp connect /foocam0 /fooview0 <br  />
 and check in the viewer if the camera is the left or right <a class="el" href="namespaceiCub.html" title="This file contains the definition of unique IDs for the body parts and the skin parts of the robot.">iCub</a> eye. Supposing that it is the left one, write the guid parameter in the dragonfly2_config_left*.ini files as shown in the former section. Do the same for the other camera, using unit number 1:</p>
<p>yarpdev &ndash;device grabber &ndash;subdevice dragonfly 2 &ndash;name /foocam1 &ndash;d 1 <br  />
yarpview &ndash;name /fooview1 <br  />
yarp connect /foocam1 /fooview1 <br  />
 and set the corresponding guid in the other camera's .ini files, <b>without leading 0x</b>.</p>
<h2><a class="anchor" id="features"></a>
Features</h2>
<ul>
<li>brightness</li>
<li>exposure</li>
<li>sharpness</li>
<li>hue</li>
<li>saturation</li>
<li>gamma</li>
<li>shutter</li>
<li>gain</li>
<li>iris</li>
</ul>
<p>Please notice that ''exposure'' is an auto mode, if set it controls ''gain'' and ''shutter'' parameters in order to match the desired ''exposure''.</p>
<h1><a class="anchor" id="portsa_sec"></a>
Ports Accessed</h1>
<p>None.</p>
<h1><a class="anchor" id="portsc_sec"></a>
Ports Created</h1>
<p>The dragonfly device driver is usually executed combined with a network wrapper grabber (called <em>grabber</em>, see examples below) which reads images from the driver and streams them on the network. The grabber opens the followig ports:</p>
<p>Output ports:</p><ul>
<li>&lt;as specified by --name&gt; streams out a yarp::sig::ImageOf&lt;yarp::sig::PixelRgb&gt; which contains the image grabbed by the Dragonfly camera.</li>
</ul>
<p>Input ports:</p><ul>
<li>&lt;as specified by --name&gt; input port to control the camera features and acquisition modes, accept a yarp::os::Bottle. The FrameGrabberGui module connects to this port.</li>
</ul>
<h1><a class="anchor" id="in_files_sec"></a>
Input Data Files</h1>
<p>None.</p>
<h1><a class="anchor" id="out_data_sec"></a>
Output Data Files</h1>
<p>None.</p>
<h1><a class="anchor" id="conf_file_sec"></a>
Configuration Files</h1>
<p>None.</p>
<h1><a class="anchor" id="tested_os_sec"></a>
Tested OS</h1>
<p>Linux and Windows.</p>
<h1><a class="anchor" id="example_sec"></a>
Example Instantiation of the Module</h1>
<p>Usage syntax:</p>
<p>yarpdev &ndash;device grabber &ndash;subdevice dragonfly2 &ndash;name &lt;yarp port name&gt; [&ndash;video_type &lt;type&gt;] [&ndash;width|size_x &lt;W&gt; &ndash;height|size_y &lt;H&gt;] [&ndash;port_number &lt;pn&gt;] [&ndash;guid &lt;64_bit_camera_unique_identifier&gt;] [&ndash;white_balance &lt;red_value&gt; &lt;blue_value&gt;] [&ndash;feature &lt;parameter&gt;] [...]</p>
<p>yarpdev &ndash;device grabber &ndash;subdevice dragonfly2raw &ndash;name &lt;yarp port name&gt; [&ndash;width|size_x &lt;W&gt; &ndash;height|size_y &lt;H&gt;] [&ndash;port_number &lt;pn&gt;] [&ndash;guid &lt;64_bit_global_unique_identifier&gt;] [&ndash;white_balance &lt;red_value&gt; &lt;blue_value&gt;] [&ndash;feature &lt;parameter&gt;] [...]</p>
<p><b>WARNING: the old &ndash;d &lt;unit_number&gt; parameter is still working but deprecated, please use &ndash;guid &lt;64_bit_global_unique_identifier&gt; instead, because &ndash;d &lt;unit_number&gt; camera has become non deterministic in left/right assignment in latest linux releases.</b></p>
<p>Example:</p>
<p>yarpdev &ndash;device grabber &ndash;subdevice dragonfly2 &ndash;name /icub/cam/left &ndash;guid AB10980D6656E455 [...]</p>
<p>yarpdev &ndash;device grabber &ndash;subdevice dragonfly2 &ndash;name /icub/cam/right &ndash;guid 98FF0666E478A001 [...]</p>
<p>yarpdev &ndash;device grabber &ndash;subdevice dragonfly2raw &ndash;name /icub/cam/left &ndash;guid AB10980D6656E455 [...]</p>
<p>yarpdev &ndash;device grabber &ndash;subdevice dragonfly2raw &ndash;name /icub/cam/right &ndash;guid 98FF0666E478A001 [...]</p>
<p><b>DEPRECATED:</b></p>
<p>yarpdev &ndash;device grabber &ndash;subdevice dragonfly2 &ndash;name /icub/cam/right &ndash;d 1|0 [...]</p>
<p>yarpdev &ndash;device grabber &ndash;subdevice dragonfly2 &ndash;name /icub/cam/left &ndash;d 0|1 [...]</p>
<p>yarpdev &ndash;device grabber &ndash;subdevice dragonfly2raw &ndash;name /icub/cam/left &ndash;d 0|1 [...]</p>
<p>yarpdev &ndash;device grabber &ndash;subdevice dragonfly2raw &ndash;name /icub/cam/right &ndash;d 1|0 [...]</p>
<dl class="section author"><dt>Author</dt><dd>Paul Fitzpatrick, Lorenzo Natale, Giorgio Metta, Alessandro Scalzo</dd></dl>
<p>Copyright (C) 2008 RobotCub Consortium</p>
<p>CopyPolicy: Released under the terms of the GNU GPL v2.0.</p>
<p>This file can be edited at /src/libraries/icubmod/dragonfly2/common/DragonflyDeviceDriver2.h </p>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Tue Mar 26 2024 16:02:19 for iCub-main by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
