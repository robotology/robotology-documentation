<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>iCub-main: actionsRenderingEngine</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">iCub-main
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">actionsRenderingEngine<div class="ingroups"><a class="el" href="group__icub__modules__all.html">Software</a> &raquo; <a class="el" href="group__icub__module.html">iCub modules</a></div></div>  </div>
</div><!--header-->
<div class="contents">

<p>A module combining multiple libraries and modules from the <a class="el" href="namespaceiCub.html" title="This file contains the definition of unique IDs for the body parts and the skin parts of the robot.">iCub</a> repository that allows to execute some basic and complex actions on objects placed on a table in front of the robot.  
</p>
<div id="dynsection-0" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-0-trigger" src="closed.png" alt="+"/> Collaboration diagram for actionsRenderingEngine:</div>
<div id="dynsection-0-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-0-content" class="dyncontent" style="display:none;">
<div class="center"><img src="group__actionsRenderingEngine.png" border="0" usemap="#agroup____actionsRenderingEngine" alt=""/></div>
<map name="agroup____actionsRenderingEngine" id="agroup____actionsRenderingEngine">
<area shape="rect" href="group__icub__module.html" title="This is the list of iCub modules, i.e." alt="" coords="5,5,116,31"/>
<area shape="rect" title="A module combining multiple libraries and modules from the iCub repository that allows to execute som..." alt="" coords="164,5,343,31"/>
</map>
</div>
<p>A module combining multiple libraries and modules from the <a class="el" href="namespaceiCub.html" title="This file contains the definition of unique IDs for the body parts and the skin parts of the robot.">iCub</a> repository that allows to execute some basic and complex actions on objects placed on a table in front of the robot. </p>
<h1><a class="anchor" id="intro_sec"></a>
Description</h1>
<p>This module makes use of the <a class="el" href="group__ActionPrimitives.html">actionPrimitives</a> library in order to interact with the objects placed on a table. The module can independently receive visual inputs from a stereo/mono tracker or from an object detector. The module will ask the system to perform the translation from stereo to cartesian information according to the current "stereo to cartesian" modality chosen:</p>
<p>&ndash; homography: which assumes that the target point lies on a table and exploits homography to obtain the relative 3D cartesian coordinates.</p>
<p>&ndash; disparity: which uses the StereoDisparity module to obtain the 3D cartesian estimate of the 2D target.</p>
<p>&ndash; network: which uses a previously trained neural network structure to predict the 3D cartesian coordinate from the stereo input.</p>
<h1><a class="anchor" id="cmd_port"></a>
Issuing commands</h1>
<p>The commands sent as bottles to the module port /&lt;modName&gt;/cmd:io are described in the following. The response to any command consists in the vocab [ack]/[nack] in case of success/failure.</p>
<p>Some commands require to specify a visual target for the action required. In these cases the parameter [target] can be expressed as follows:</p>
<p>(notation: [.] identifies a vocab, "." identifies a string, &lt;.&gt; identifies a double)</p>
<p>&ndash;[motion] when using motion cues to detect the visual target.</p>
<p>&ndash;[track] when using the output of the visual tracker.</p>
<p>&ndash;[fixation] when the target is assumed to be in both cameras image centers.</p>
<p>&ndash;[raw] when the target is provided as a raw couple of camera plane coordinates to one of the two 'raw:i' ports.</p>
<p>&ndash;("left"|"right" u v) when the target is a 2D couple of camera plane coordinates. If not specified, camera is assumed to be "left".</p>
<p>&ndash;("cartesian" x y z) or (x y z) when the target is a 3D cartesian position wrt the robot's reference frame.</p>
<p>&ndash;("cartesian" x y z ax ay az theta) or (x y z ax ay az theta): occasionally also the orientation can be provided.</p>
<p>&ndash;"object_name" when using a visual classifier to localize objects. This option represents a label to access online information stored in the databased provided by <a class="el" href="group__objectsPropertiesCollector.html">objectsPropertiesCollector</a> module. The label itself is used to access the corresponding object through the "name" property, whereas the relevant 3D information are available through the "position_3d" property.</p>
<p>General Parameters:</p>
<p>The majority of commands can usually be provided with general optional parameters:</p>
<p>&ndash;&lt;arm&gt;: the user can specify the arm required for the action ("left"/"right"). Otherwise the default arm will be used.</p>
<p>&ndash;"no_head"/"no_gaze": the action does not affect the gaze of the robot (this parameter does not influece commands that explicitly require to move the head like LOOK).</p>
<p>&ndash;"no_sacc": disables the saccadic movements of the gaze controller during the action.</p>
<p>&ndash;"still": prevents the robot from bringing back home the arm after having accomplished the action.</p>
<p>The commands:</p>
<p><b>IDLE</b> <br  />
format: [idle] <br  />
action: the gaze controller is reset to the original context stored at start and head/eye control is interrupted.</p>
<p><b>HOME</b> <br  />
format: [home] "param1" "param2" <br  />
action: the arms are sent to home position. the optional parameters "param1" and "param2" can be independently set to "gaze" or "head" in order to bring the gaze controller in home position and "fingers" or "hands" to open the robot hands. Alternatively the parameter "all" can be supplied to perform both optional actions.</p>
<p><b>OBSERVE</b> <br  />
format: [observe] <br  />
action: if the robot is holding an object it brings it in the FoV of its cameras with the final purpose of visually explore it.</p>
<p><b>DROP</b> <br  />
format: [drop] "param1" or [drop] "over" [target] "param1" <br  />
action: if the robot is holding an object it brings it over the table and drops it on a random position approximatively in front of it. Optional parameter "away" can be provided in orded to have the robot leave the object outside the cameras FoV (on the right or left side of the robot depending on the arm in use). Optional parameter "over" can be supplied together with the action [target] in order to have the robot drop the object on top of the visual target.</p>
<p><b>HAND</b> <br  />
format: [hand] "action-type" "hand-type" <br  />
action: perform the hand sequence specified by the action-type with the hand specified by the hand-type.</p>
<p><b>TAKE</b> <br  />
format: [take] [target] "param1" <br  />
action: the robot tries to reach the specified [target] and grasp it. Optional parameter "side" or "above" can be supplied to choose the orientation the robot should try to mantain while performing the action (default: "above").</p>
<p><b>TAKE_TOOL</b> <br  />
format: [tato] "param1" <br  />
action: the robot will reach a specified position to take the tool from a user. Optional parameter "left" or "right" can be supplied to choose the orientation the robot</p>
<p><b>GRASP</b> <br  />
format: [grasp] [target] <br  />
action: the robot tries to reach the specified [target] and performs a power grasp. The target must be specified both in cartesian position and orientation. <br  />
As further parameter user may specify the way the robot will approach the target by providing the options ("approach" (dx dy dz wrist_pitch)), where dx/dy/dz account for offset displacement in meters wrt to the grasping reference frame and wrist_pitch is the apporaching pitch of the wrist given in degrees.</p>
<p><b>TOUCH</b> <br  />
format: [touch] [target] "param1" "param2" <br  />
action: the robot tries to reach the specified [target] and then brings the arm back to home position. Optional parameter "side" or "above" can be supplied to choose the orientation the robot should try to mantain while performing the action (default: "above").</p>
<p><b>PUSH</b> <br  />
format: [push] [target] "param1" <br  />
action: the robot tries to reach the specified [target] from one side and then push it laterally. Optional parameter "away" can be supplied in order to have the robot push the object away from its root reference frame.</p>
<p><b>POINT</b> <br  />
format: [point] [target] <br  />
action: the robot tries to point at the specified [target] with its index finger.</p>
<p><b>POINT_FAR</b> <br  />
format: [pfar] [target] <br  />
action: the robot tries to point at the specified [target] located far from the robot.</p>
<p><b>LOOK</b> <br  />
format: [look] [target] "param1" (block_eyes &lt;ver&gt;) <br  />
action: the robot looks at the specified [target]. "param1" can be set equal to "fixate" in order to keep the gaze fixating the requested target also when other commands are issued to the torso. The further option "wait" can be specified in order to let the robot wait until the target is under fixation before returning.<br  />
If provided, the option (block_eyes &lt;ver&gt;) serves to block the eyes at the specified vergence while gazing. <br  />
Note: the special target [hand] (with optional parameter "left"/"right") can be provided to have the robot look at its own hand. The robot will keep looking at its own hand until an idle command.</p>
<p><b>EXPECT</b> <br  />
format: [expect] <br  />
action: the robot puts one arm forward with the palm of the hand facing up and waiting for an object to be put on it.</p>
<p><b>GIVE</b> <br  />
format: [give] <br  />
action: the robot puts one arm forward with the palm of the hand facing up and opens the fingers so that the object held in the hand is free to be taken.</p>
<p><b>TRACK</b> <br  />
format: [track] [target] "param1" <br  />
action: the specified [target] position is supplied to the tracker module and the gaze controller is updated in order to keep the object constantly inside the robot fovea. The optional "param1" can be put equal to "no_sacc" in order to disable the saccadic movements of the gaze controller during the tracking process.</p>
<p><b>TEACH ACTION</b> <br  />
format: [teach] "action_name" [start/stop] "param1" <br  />
action: If parameter [start] is specified and the action "action_name" has not been registered yet, the robot arm is set to torque control mode. The cartesian position (wrt the starting point) and orientation of the robot arm is stored until the command [teach] "action_name" [stop] is received. The learned action is recorded to the file "actions/&lt;arm&gt;/&lt;action_name&gt;.txt" and can be repeated autonomously using the command <b>IMITATE ACTION</b> ([imitate] "action_name").</p>
<p><b>IMITATE ACTION</b> <br  />
format: [imitate] "action_name" <br  />
action: the system loads the file "actions/&lt;arm&gt;/&lt;action_name&gt;.txt" and controls the arm in order to repeat the trajectory previously registered.</p>
<p><b>CALIBRATION</b><br  />
different types of calibrations can be requested by issuing commands of the form: [calib] [calibration_type] "param1" "param2" In the following a short description of the possible values of [calibration_type]:</p>
<p>&ndash;[table] the robot will try to find out the table height exploiting the contact detection based on force control. If the contact is detected then the new table height is sent to the homography module that is in charge of extracting the 3d coordinates of the object from its 2d projection on the image plane. The file containing the table information is also updated accordingly to avoid calibrating always at start-up.</p>
<p>&ndash;[fingers] the robot will calibrate the fingers in order to detect whether correct grasp has been achieved.</p>
<p>&ndash;[kinematics] this option requires a parameter [start/stop]. when started, the system is set to cartesian torque control and the robot arm can be moved around by the human user. When the [calib] [kinematics] [stop] command is received, the system is set to stiff mode and the offset between the initial and the current position is stored. It is also possible to associate a specific kinematic offset to a single object. To do so, it is required to issue the command [calib] [kinematics] [stop] &lt;object_name&gt;. Then, whenever the system will be asked to preform an action over such object, the system will use the learnt offset.</p>
<p><b>EXPLORATION</b> <br  />
different types of explorations can be requested by issuing commands of the form: [explore] [exploration_type] In the following a short description of the possible values of [exploration_type]:</p>
<p>&ndash;[torso] the robot will start moving its torso exploring different positions (specified in the file exploration_poses.ini). then it will go back to the initial position.</p>
<p>&ndash;[hand] the robot will start moving its hand (typically while holding an object) and at the same time look at it. For safety issues, by default the robot moves the other hand back to home position in order to avoid collision. This behaviour can be modified by providing the optional parameter "keep_other_hand_still".</p>
<h1><a class="anchor" id="get_port"></a>
The "Get" Port</h1>
<p>The actionsRenderingEngine can be queried via the port /&lt;modName&gt;/get:io in order to obtain the following data:</p>
<p><b>GET</b> format: [get] &lt;request&gt; action: the system returns the requested element.</p>
<p>&lt;request&gt; can be of the form:</p>
<p>&ndash;[s2c] [target_1] ... [target_n]: returns the current cartesian coordinates of the n visual targets wrt to the robot root reference frame. The number of targets is not predefined.</p>
<p>&ndash;[table]: returns the current height of the table in front of the robot</p>
<p>&ndash;[holding]: returns true if the robot is holding an object in its active hand.</p>
<p>&ndash;[hand] [image]: returns a vector of the form (u_left v_left u_right v_right hand-head-distance) that reports the projection of the end-effector of the active arm in both the robot cameras together with the distance (in meters) between the robot forehead and its hand.</p>
<h1><a class="anchor" id="lib_sec"></a>
Libraries</h1>
<ul>
<li>YARP libraries.</li>
<li><a class="el" href="group__ActionPrimitives.html">actionPrimitives</a> library.</li>
</ul>
<h1><a class="anchor" id="portsa_sec"></a>
Ports Accessed</h1>
<p>Assume that the robot interface is operative and the <a class="el" href="group__wholeBodyDynamics.html">wholeBodyDynamics</a> is running.</p>
<h1><a class="anchor" id="portsc_sec"></a>
Ports Created</h1>
<p>Aside from the internal ports created by <a class="el" href="group__ActionPrimitives.html">actionPrimitives</a> library, we also have:</p>
<ul>
<li><em>/</em> &lt;modName&gt;/wbd:rpc to be connected to <em>/wholeBodyDynamics/rpc</em>:i in order to allow for resetting force offsets in the computation of internal dynamics of the robot.</li>
<li><em>/</em> &lt;modName&gt;/cmd:io receives a bottle containing commands whose formats are specified in the previous section. The port replies as soon as the current action has been completed.</li>
<li><em>/</em> &lt;modName&gt;/rpc remote procedure call. Recognized remote commands:<br  />
 -[help]: returns the list of available rpc commands.<br  />
 -[get]: get requests<br  />
 -[status]: returns the bottle (gaze &lt;status&gt;) (left_arm &lt;status&gt;) (right_arm &lt;status&gt;) where &lt;status&gt; can be equal to "idle", "busy" or "unavailable".<br  />
 -[impedance] [on]/[off]: enable/disable (if available) impedance control.<br  />
 -[waveing] [on]/[off]: enable/disable the <a class="el" href="namespaceiCub.html" title="This file contains the definition of unique IDs for the body parts and the skin parts of the robot.">iCub</a> arm(s) waving.<br  />
 -[mode] [homography]/[disparity]/[network]: sets the desired stereo to cartesian mode.<br  />
 -[interrupt]: interrupts any action deleting also the action queue for both arms.<br  />
 -[reinstate]: if the module was interrupted reinstate it.<br  />
 -[elbow] "left"|"right"|"both" &lt;height&gt; &lt;weight&gt;: to change elbow parameters. <br  />
 -[time] &lt;time&gt;: to change default arm movement execution time (in seconds).</li>
</ul>
<h1><a class="anchor" id="parameters_sec"></a>
Parameters</h1>
<p>The following are the options that are not usually contained within the configuration file.</p>
<p>&ndash;name <em>name</em> </p><ul>
<li>specify the module name, which is <em>actionsRenderingEngine</em> by default.</li>
</ul>
<p>&ndash;from <em>file</em> </p><ul>
<li>specify the configuration file (use <em>&ndash;context</em> option to select the current context)</li>
</ul>
<h1><a class="anchor" id="in_files_sec"></a>
Input Data Files</h1>
<p>&ndash; kinematic_offsets.ini contains the table height as well as the arms kinematic offsets and is updated on-line as result of an exploration phase. &ndash; network.ini contains the information needed by the system to load the neural network that computes the stereo2cartesian mapping. &ndash; hands_sequences.ini contains the list of hand sequences for the action primitives. &ndash; exploration_poses.ini contains a list of position used to explore multiple points of view with the robot torso. &ndash; grasp_model_&lt;hand&gt;.ini contains the information needed by the PerceptiveModel layer. &ndash; actions/&lt;arm&gt;/&lt;action_name&gt;.actions each action "learned by imitation" is stored in a .txt file with the same name of the action itself.</p>
<h1><a class="anchor" id="tested_os_sec"></a>
Tested OS</h1>
<p>Windows, Linux</p>
<dl class="section author"><dt>Author</dt><dd>Carlo Ciliberto, Vadim Tikhanoff </dd></dl>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Tue Mar 26 2024 16:02:19 for iCub-main by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
